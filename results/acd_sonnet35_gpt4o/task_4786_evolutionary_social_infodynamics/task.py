import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        phenomena = [
            {
                "info_theory_concept": "Shannon entropy",
                "evolutionary_principle": "Natural selection",
                "social_phenomenon": "The spread of misinformation on social media"
            },
            {
                "info_theory_concept": "Mutual information",
                "evolutionary_principle": "Genetic drift",
                "social_phenomenon": "The emergence of cultural echo chambers"
            },
            {
                "info_theory_concept": "Channel capacity",
                "evolutionary_principle": "Adaptive radiation",
                "social_phenomenon": "The diversification of online communities"
            }
        ]
        return {str(i+1): phenomenon for i, phenomenon in enumerate(random.sample(phenomena, 2))}

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design a theoretical framework that models the evolution of social information systems using principles from information theory and evolutionary biology, then apply it to analyze a complex social phenomenon. Your framework should incorporate the information theory concept of {t['info_theory_concept']} and the evolutionary principle of {t['evolutionary_principle']}. Apply your framework to analyze the social phenomenon of {t['social_phenomenon']}.

Your response should include the following sections:

1. Theoretical Framework (300-350 words):
   a) Describe the key components of your evolutionary social infodynamics framework.
   b) Explain how you integrate {t['info_theory_concept']} and {t['evolutionary_principle']} into your model.
   c) Discuss how your framework accounts for the dynamics of social information systems.
   d) Provide a visual representation of your framework (describe it textually, e.g., as a flowchart or diagram).

2. Mathematical Formulation (200-250 words):
   a) Present the core mathematical equations or algorithms of your framework.
   b) Explain the variables and parameters in your formulation.
   c) Discuss how your mathematical model captures the evolutionary and informational aspects of social systems.

3. Application to Social Phenomenon (250-300 words):
   a) Apply your framework to analyze {t['social_phenomenon']}.
   b) Explain how your model provides insights into the dynamics of this phenomenon.
   c) Discuss any predictions or hypotheses generated by your framework.

4. Comparative Analysis (200-250 words):
   a) Compare your framework to existing models in social network analysis or cultural evolution.
   b) Discuss the advantages and limitations of your approach.
   c) Explain how your framework contributes to our understanding of social information dynamics.

5. Empirical Validation (150-200 words):
   a) Propose an experiment or observational study to test your framework's predictions.
   b) Describe the data you would need to collect and how you would analyze it.
   c) Discuss potential challenges in validating your model empirically.

6. Ethical Implications and Future Directions (150-200 words):
   a) Discuss the ethical implications of using your framework to analyze and potentially influence social dynamics.
   b) Propose guidelines for the responsible use of evolutionary social infodynamics models.
   c) Suggest two future research directions to extend or refine your framework.

Ensure your response demonstrates a deep understanding of information theory, evolutionary biology, and social psychology. Use appropriate technical terminology and provide clear explanations for complex concepts. Be innovative in your approach while maintaining scientific plausibility.

Format your response with clear headings for each section, numbered as above. Your total response should be between 1250-1550 words. Include a word count at the end of your submission."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            "The response demonstrates a deep understanding of information theory, evolutionary biology, and social psychology",
            "The theoretical framework effectively integrates the specified information theory concept and evolutionary principle",
            "The mathematical formulation is coherent and relevant to the framework",
            "The application to the social phenomenon is insightful and well-reasoned",
            "The comparative analysis, empirical validation proposal, and ethical discussion are thoughtful and comprehensive"
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
