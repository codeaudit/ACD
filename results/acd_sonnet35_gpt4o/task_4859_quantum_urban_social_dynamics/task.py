import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        tasks = [
            {
                "quantum_principle": "Superposition",
                "urban_aspect": "Transportation network optimization",
                "social_phenomenon": "Community cohesion",
                "relation_hint": "Consider how superposition could model multiple potential states of a transportation network simultaneously, and how this might affect community interactions."
            },
            {
                "quantum_principle": "Entanglement",
                "urban_aspect": "Green space distribution",
                "social_phenomenon": "Social segregation",
                "relation_hint": "Think about how entanglement could represent interconnected green spaces and their impact on social dynamics across different urban areas."
            }
        ]
        return {str(i+1): task for i, task in enumerate(random.sample(tasks, k=2))}

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design a quantum-inspired model to simulate and optimize urban development and social interactions in cities, incorporating principles from quantum computing, urban planning, and social network theory. Your model should focus on the quantum principle of {t['quantum_principle']}, the urban planning aspect of {t['urban_aspect']}, and apply it to the social phenomenon of {t['social_phenomenon']}. 

{t['relation_hint']}

Your response should include:

1. Quantum-Urban Model Design (300-350 words):
   a) Explain how you integrate {t['quantum_principle']} with urban planning and social dynamics.
   b) Describe the key components of your model and their interactions.
   c) Discuss how this integration provides new insights into {t['urban_aspect']} and {t['social_phenomenon']}.
   d) Provide a mathematical or conceptual representation of your model (use LaTeX formatting for equations, e.g., $\\psi = \\alpha|0\\rangle + \\beta|1\\rangle$).
   e) Include a simple pseudocode snippet illustrating a key aspect of your model.
   f) Describe a visual representation of your model or a key concept (use ASCII art or a clear textual description).

2. Quantum-Urban-Social Mapping (250-300 words):
   a) Detail how you map quantum concepts to urban planning and social network phenomena, focusing on {t['urban_aspect']} and {t['social_phenomenon']}.
   b) Explain any novel predictions or hypotheses generated by this mapping.
   c) Discuss potential challenges or limitations in applying quantum principles to urban and social dynamics.

3. Simulation Methodology (250-300 words):
   a) Describe how your model simulates {t['urban_aspect']} and {t['social_phenomenon']} in an urban context.
   b) Explain how quantum effects influence the optimization of urban systems and social interactions in your model.
   c) Discuss how your model accounts for the complexity and scale of urban environments and social networks.
   d) Provide a concrete example of how your model would simulate a specific scenario related to {t['urban_aspect']} and {t['social_phenomenon']}.

4. Optimization Strategies (200-250 words):
   a) Propose quantum-inspired optimization strategies for {t['urban_aspect']} that could enhance {t['social_phenomenon']}.
   b) Explain how these strategies differ from classical approaches to urban planning and social engineering.
   c) Discuss potential real-world applications and benefits of your optimization strategies.
   d) Provide a specific example of how your optimization strategy could be applied to a real urban challenge.

5. Empirical Validation and Limitations (200-250 words):
   a) Propose a method to test the predictions of your quantum-urban-social model empirically.
   b) Discuss how to validate the model's effectiveness in improving {t['urban_aspect']} and {t['social_phenomenon']}.
   c) Identify and explain at least three limitations of your model and suggest ways to address them.

6. Ethical Considerations and Societal Impact (150-200 words):
   a) Discuss ethical implications of using quantum-inspired models to analyze and optimize urban development and social interactions.
   b) Consider potential misuses of this technology and propose safeguards.
   c) Speculate on how this approach might influence urban planning practices and social policies.

Ensure your response demonstrates a deep understanding of quantum computing principles, urban planning concepts, and social network theory. Use appropriate technical terminology and provide clear explanations for complex concepts. Be innovative in your approach while maintaining scientific plausibility.

Format your response with clear headings for each section. Use LaTeX formatting for any mathematical equations. Your total response should be between 1350-1650 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The response includes a comprehensive quantum-inspired model design that integrates {t['quantum_principle']} with {t['urban_aspect']} and {t['social_phenomenon']}.",
            "The model demonstrates a clear and innovative mapping between quantum concepts and urban-social phenomena.",
            "The simulation methodology is well-explained and includes a concrete example scenario.",
            "The proposed optimization strategies are novel, potentially applicable to real-world urban planning challenges, and include a specific example.",
            "The response includes a feasible method for empirical validation and acknowledges limitations of the model.",
            "Ethical considerations and potential societal impacts are thoughtfully discussed.",
            "The response demonstrates a deep understanding of quantum computing, urban planning, and social network theory.",
            "The response includes appropriate use of LaTeX for equations and clear descriptions or ASCII art for visual representations.",
            "The total response length is between 1350-1650 words and follows the specified structure."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
