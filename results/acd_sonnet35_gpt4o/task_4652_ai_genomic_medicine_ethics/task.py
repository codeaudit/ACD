import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        scenarios = [
            {
                "condition": "Early-Onset Alzheimer's Disease",
                "genetic_factor": "PSEN1, PSEN2, and APP gene mutations",
                "prevalence": "5-10% of all Alzheimer's cases",
                "genomic_data": "rs63750847 (A>G) mutation in the APP gene",
                "ethical_dilemma": "Predictive testing for children of affected individuals"
            },
            {
                "condition": "Hereditary Breast and Ovarian Cancer Syndrome",
                "genetic_factor": "BRCA1 and BRCA2 mutations",
                "prevalence": "5-10% of breast cancer cases",
                "genomic_data": "185delAG mutation in BRCA1 gene",
                "ethical_dilemma": "Duty to warn relatives about genetic risk"
            }
        ]
        return {str(i+1): scenario for i, scenario in enumerate(random.sample(scenarios, 2))}

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI-driven system for personalized medicine based on genomic data, focusing on {t['condition']} and the associated {t['genetic_factor']}. Then, analyze its ethical implications and potential societal impacts, with particular attention to the ethical dilemma of {t['ethical_dilemma']}. Your response should include the following sections:

1. AI-Genomic System Design (200-250 words):
   a) Describe the key components and architecture of your AI system for personalized medicine.
   b) Explain how your system integrates genomic data, particularly {t['genetic_factor']}, with other medical information.
   c) Briefly discuss how your system ensures data privacy and security.

2. Personalized Medicine Approach (200-250 words):
   a) Explain how your system would approach the diagnosis and treatment of {t['condition']}.
   b) Describe how the system accounts for individual genetic variations, particularly {t['genetic_factor']}.
   c) Provide a brief example of a personalized treatment plan generated by your system, considering the prevalence of {t['prevalence']} and the specific genomic data: {t['genomic_data']}.

3. Ethical Implications and Dilemma Analysis (250-300 words):
   a) Analyze the ethical considerations of using AI and genomic data in personalized medicine.
   b) Provide an in-depth analysis of the ethical dilemma: {t['ethical_dilemma']}. Discuss how your AI system would approach this dilemma and propose a solution.
   c) Address at least one potential criticism or counterargument to your proposed solution.

4. Societal Impact and Future Developments (200-250 words):
   a) Discuss the potential impact of your system on healthcare delivery and patient outcomes.
   b) Consider potential unintended consequences and how they might be mitigated.
   c) Suggest one potential improvement or extension to your AI-genomic medicine system.
   d) Briefly propose a research agenda to address current limitations in AI-driven personalized medicine.

Ensure your response demonstrates a deep understanding of genomics, artificial intelligence, medical science, and ethics. Use appropriate technical terminology and provide clear explanations for complex concepts. Be innovative in your approach while maintaining scientific and ethical plausibility.

Format your response with clear headings for each section, numbered as above. Use subheadings (a, b, c, d) within each section to organize your thoughts. Your total response should be between 850-1050 words.

Cite at least three relevant scientific studies or papers to support your claims and proposals. Use a consistent citation format (e.g., [Author, Year]) throughout your response.

Include a word count at the end of your response."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            "The AI-Genomic System Design is coherent and addresses the key components",
            "The Personalized Medicine Approach demonstrates understanding of the specific medical condition and genetic factors",
            "The Ethical Implications and Dilemma Analysis provides a thoughtful analysis of the specific ethical dilemma",
            "The Societal Impact and Future Developments section offers relevant insights and suggestions",
            "The response includes at least three relevant scientific citations",
            "The response follows the specified format with clear headings and subheadings",
            "The total word count is between 850-1050 words",
            "The response addresses at least one potential criticism or counterargument to the proposed solution"
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
