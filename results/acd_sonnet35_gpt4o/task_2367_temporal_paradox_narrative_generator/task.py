import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        paradox_types = ['bootstrap paradox', 'grandfather paradox', 'predestination paradox']
        narrative_elements = ['character development', 'plot twist', 'ethical dilemma']
        tasks = [
            {
                'paradox_type': random.choice(paradox_types),
                'narrative_element': random.choice(narrative_elements),
                'time_period': 'past'
            },
            {
                'paradox_type': random.choice(paradox_types),
                'narrative_element': random.choice(narrative_elements),
                'time_period': 'future'
            }
        ]
        return {str(i+1): task for i, task in enumerate(tasks)}

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system capable of generating and analyzing narratives involving temporal paradoxes, then use it to explore the logical and creative implications of time travel in storytelling. Focus on the {t['paradox_type']} and incorporate a significant {t['narrative_element']} set in the {t['time_period']}. Your response should include the following sections:

1. AI System Architecture (300-350 words):
   a) Describe the key components of your AI system for generating and analyzing temporal paradox narratives.
   b) Explain how your system represents and manipulates temporal events and causal relationships.
   c) Detail any novel algorithms or techniques used to handle paradoxical situations.
   d) Include a high-level diagram or flowchart of your system's architecture (describe it textually).

2. Paradox Generation Process (250-300 words):
   a) Explain step-by-step how your AI system generates a narrative incorporating the specified temporal paradox.
   b) Describe how the system ensures logical consistency while maintaining narrative engagement.
   c) Discuss how the system integrates the specified narrative element into the paradox-driven story.

3. Sample Narrative Output (300-350 words):
   a) Provide a brief (150-200 words) narrative generated by your AI system that showcases the specified paradox type, narrative element, and time period.
   b) Analyze the generated narrative, highlighting how it embodies the paradox and incorporates the narrative element.
   c) Explain any creative or unexpected elements in the generated story.

4. Paradox Analysis (250-300 words):
   a) Describe how your AI system would analyze the logical implications of the generated paradox.
   b) Explain the process by which the system identifies and resolves (if possible) logical inconsistencies.
   c) Discuss any insights or novel interpretations of the paradox that emerge from your system's analysis.

5. Temporal Reasoning Capabilities (200-250 words):
   a) Evaluate the temporal reasoning capabilities demonstrated by your AI system.
   b) Compare your system's approach to temporal reasoning with existing AI models or human cognition.
   c) Propose a method to quantitatively assess the system's performance in handling temporal paradoxes.

6. Creative and Ethical Implications (200-250 words):
   a) Discuss the potential impact of your system on creative writing and storytelling.
   b) Explore any ethical considerations raised by AI-generated narratives involving time travel and paradoxes.
   c) Propose guidelines for the responsible use of such AI systems in literature and entertainment.

7. Future Developments and Challenges (150-200 words):
   a) Identify key challenges in further developing AI systems for temporal paradox narratives.
   b) Suggest potential improvements or extensions to your system.
   c) Discuss how advances in this area might contribute to our understanding of time, causality, and narrative structure.

Ensure your response demonstrates a deep understanding of temporal logic, narrative theory, and artificial intelligence. Use appropriate technical terminology and provide clear explanations for complex concepts. Be creative in your approach while maintaining scientific and logical plausibility.

Format your response with clear headings for each section. Your total response should be between 1650-2000 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            "The response demonstrates a deep understanding of temporal logic, narrative theory, and artificial intelligence.",
            "The AI system architecture is well-designed and clearly explained, with novel approaches to handling temporal paradoxes.",
            "The paradox generation process is logically sound and creatively implemented.",
            "The sample narrative effectively incorporates the specified paradox type, narrative element, and time period.",
            "The paradox analysis shows sophisticated reasoning about temporal inconsistencies and their resolution.",
            "The temporal reasoning capabilities of the system are well-evaluated and compared to existing approaches.",
            "Creative and ethical implications are thoughtfully explored with insightful guidelines proposed.",
            "Future challenges and developments are identified, with plausible suggestions for advancement.",
            "The response is well-structured, adhering to the specified sections and word counts.",
            "The writing demonstrates creativity while maintaining scientific and logical plausibility."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
