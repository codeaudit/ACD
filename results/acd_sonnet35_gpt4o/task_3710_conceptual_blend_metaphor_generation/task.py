import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        scientific_concepts = [
            "quantum entanglement",
            "neural plasticity",
            "climate feedback loops",
            "epigenetic inheritance"
        ]
        cultural_domains = [
            "Inuit traditions",
            "Amazonian rainforest ecology",
            "Balinese gamelan music",
            "Moroccan architecture"
        ]
        return {
            "1": {
                "concept": random.choice(scientific_concepts),
                "domain": random.choice(cultural_domains)
            },
            "2": {
                "concept": random.choice(scientific_concepts),
                "domain": random.choice(cultural_domains)
            }
        }

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system that generates novel metaphors through conceptual blending, then apply it to explain the complex scientific concept of {t['concept']} using the cultural domain of {t['domain']} as a source. Your response should include the following sections:

1. Conceptual Blending System Architecture (250-300 words):
   a) Describe the key components of your AI system for conceptual blending and metaphor generation.
   b) Explain how your system represents and manipulates conceptual spaces.
   c) Detail the process of identifying and merging relevant aspects of the source and target domains.
   d) Discuss any novel techniques or algorithms used in your design.

2. Cultural Knowledge Integration (200-250 words):
   a) Explain how your system incorporates and represents knowledge about {t['domain']}.
   b) Describe the methods used to ensure cultural sensitivity and accuracy in metaphor generation.
   c) Discuss challenges in adapting the system to diverse cultural contexts.

3. Metaphor Generation Process (200-250 words):
   a) Provide a step-by-step explanation of how your AI system generates a metaphor for {t['concept']} using {t['domain']}.
   b) Describe how the system ensures the generated metaphor is both scientifically accurate and culturally appropriate.
   c) Explain any techniques used to enhance the creativity and novelty of the generated metaphors.

4. Example Output and Analysis (250-300 words):
   a) Present an example metaphor generated by your system to explain {t['concept']} using elements from {t['domain']}.
   b) Analyze the metaphor, explaining how it captures key aspects of the scientific concept.
   c) Discuss the cultural significance and appropriateness of the metaphorical elements used.
   d) Evaluate the metaphor's potential effectiveness in explaining the concept to a general audience.

5. Evaluation and Refinement (150-200 words):
   a) Propose methods to evaluate the quality, accuracy, and cultural sensitivity of the generated metaphors.
   b) Describe how you would incorporate feedback from experts in both the scientific field and the cultural domain.
   c) Explain how the system could learn and improve its metaphor generation over time.

6. Ethical Considerations and Limitations (150-200 words):
   a) Discuss potential ethical issues related to using AI-generated metaphors for science communication.
   b) Address concerns about cultural appropriation or misrepresentation in cross-domain metaphor generation.
   c) Analyze limitations of your approach and areas for future improvement.

Ensure your response demonstrates a deep understanding of conceptual blending theory, the specified scientific concept, and the cultural domain. Be creative in your approach while maintaining scientific accuracy and cultural sensitivity. Use appropriate technical terminology and provide clear explanations where necessary.

Format your response with clear headings for each section. Your total response should be between 1200-1500 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The response should include a detailed description of an AI system for conceptual blending and metaphor generation.",
            f"The cultural knowledge integration section should demonstrate a deep understanding of {t['domain']}.",
            f"The metaphor generation process should be clearly explained and logically sound.",
            f"The example output should be a creative and appropriate metaphor explaining {t['concept']} using elements from {t['domain']}.",
            "The response should address ethical considerations and limitations of the proposed system.",
            "The overall response should demonstrate interdisciplinary knowledge application and creative problem-solving."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
