import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        tasks = [
            {
                "region": "Southeast Asia",
                "climate_challenge": "Rising sea levels and increased flooding",
                "economic_factor": "Rapid urbanization and industrialization",
                "timeframe": "50 years",
                "additional_data": "Current sea level rise rate: 4mm/year; Urbanization rate: 2.5% annually; GDP growth: 5% annually"
            },
            {
                "region": "Sub-Saharan Africa",
                "climate_challenge": "Desertification and water scarcity",
                "economic_factor": "Agricultural dependency and population growth",
                "timeframe": "30 years",
                "additional_data": "Desertification rate: 3.5% annually; Population growth: 2.7% annually; Agricultural contribution to GDP: 25%"
            }
        ]
        return {str(i+1): task for i, task in enumerate(random.sample(tasks, k=2))}

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system that integrates climate science data, economic models, and policy analysis to generate and evaluate long-term climate policy recommendations for {t['region']}. Focus on addressing the climate challenge of {t['climate_challenge']}, considering the economic factor of {t['economic_factor']}, with a timeframe of {t['timeframe']}. Additional data to consider: {t['additional_data']}. Your response should include the following sections:

1. AI System Architecture (300-350 words):
   a) Describe the key components of your AI system for climate policy analysis and recommendation.
   b) Explain how your system integrates and processes climate data, economic models, and policy information.
   c) Detail any novel algorithms or techniques used for long-term forecasting and policy evaluation.
   d) Include a high-level diagram or flowchart of your AI system architecture (describe it textually).

2. Data Integration and Analysis (250-300 words):
   a) Explain how your AI system collects and integrates diverse data sources relevant to the specified region and climate challenge.
   b) Describe the methods used to ensure data quality and handle uncertainties in long-term projections.
   c) Discuss how your system accounts for complex interactions between climate, economic, and social factors.

3. Policy Generation and Evaluation (300-350 words):
   a) Detail the process your AI uses to generate climate policy recommendations.
   b) Explain how the system evaluates the potential impact and feasibility of proposed policies.
   c) Describe how your AI considers ethical implications and potential unintended consequences of policy recommendations.
   d) Propose at least three specific policy recommendations generated by your AI system.
   e) Discuss potential trade-offs between these policy options.

4. Adaptive Learning and Uncertainty Management (200-250 words):
   a) Explain how your AI system adapts its models and recommendations as new data becomes available.
   b) Describe methods for quantifying and communicating uncertainty in policy recommendations.
   c) Discuss how the system handles potential conflicts between short-term economic interests and long-term climate resilience.

5. Stakeholder Engagement and Communication (200-250 words):
   a) Propose methods for your AI system to effectively communicate complex policy recommendations to diverse stakeholders.
   b) Describe how the system could facilitate participatory decision-making processes.
   c) Discuss potential challenges in implementing AI-generated policy recommendations and propose solutions.

6. Ethical Considerations and Safeguards (150-200 words):
   a) Identify potential ethical issues in using AI for climate policy recommendations.
   b) Propose guidelines for responsible development and use of AI in climate governance.
   c) Discuss how to ensure transparency and accountability in the AI decision-making process.

7. Innovation and Creative Solutions (200-250 words):
   a) Highlight the most innovative aspects of your AI system and its policy recommendations.
   b) Explain how these innovations leverage the AI's interdisciplinary knowledge and long-term forecasting capabilities.
   c) Discuss the potential transformative impact of these solutions on the region's climate resilience and economic development.

Ensure your response demonstrates a deep understanding of climate science, economics, policy analysis, and artificial intelligence. Use appropriate technical terminology and provide clear explanations for complex concepts. Be innovative in your approach while maintaining scientific and practical plausibility.

Format your response with clear headings for each section. Your total response should be between 1600-1950 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The response demonstrates a comprehensive understanding of the climate challenges and economic factors specific to {t['region']}, incorporating the provided additional data.",
            "The AI system architecture is well-designed and integrates climate science, economic models, and policy analysis effectively.",
            "The policy generation and evaluation process is clearly explained and considers long-term impacts and feasibility.",
            "At least three specific policy recommendations are proposed, with a discussion of potential trade-offs between them.",
            "The response addresses ethical considerations and proposes meaningful safeguards for AI use in climate governance.",
            "The proposed system demonstrates innovative approaches to handling uncertainty and adapting to new information over the specified timeframe of {t['timeframe']}.",
            "The response includes creative and potentially transformative policy solutions that address the specific challenges of the region.",
            "The stakeholder engagement and communication strategies are well-developed and practical.",
            "The response follows the required format and word count, addressing all specified sections comprehensively."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0