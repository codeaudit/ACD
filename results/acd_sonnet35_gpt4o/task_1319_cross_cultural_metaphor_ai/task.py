import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        cultures = [
            {
                "name": "Japanese",
                "language": "Japanese",
                "key_concepts": ["harmony", "nature", "hierarchy"],
                "abstract_idea": "impermanence",
                "example_metaphor": "Cherry blossoms are like life"
            },
            {
                "name": "Maasai",
                "language": "Maa",
                "key_concepts": ["cattle", "community", "warrior ethos"],
                "abstract_idea": "courage",
                "example_metaphor": "A warrior without a spear is like a cow without horns"
            },
            {
                "name": "Inuit",
                "language": "Inuktitut",
                "key_concepts": ["survival", "nature", "community"],
                "abstract_idea": "adaptability",
                "example_metaphor": "Life is like the changing seasons"
            }
        ]
        return {str(i+1): culture for i, culture in enumerate(random.sample(cultures, 2))}

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system capable of generating and interpreting metaphors for the {t['name']} culture, focusing on their language ({t['language']}) and key cultural concepts {t['key_concepts']}. Your task is to:

1. System Architecture (200-250 words):
   a) Describe the overall structure of your AI system for metaphor generation and interpretation.
   b) Explain how it incorporates cultural knowledge and linguistic features specific to the {t['name']} culture.
   c) Detail how the system handles the challenges of cross-cultural metaphor translation.

2. Metaphor Generation (200-250 words):
   a) Explain how your system would generate a metaphor for the abstract concept of "{t['abstract_idea']}" in the context of {t['name']} culture.
   b) Provide an example metaphor generated by your system, along with its explanation.
   c) Discuss how the system ensures cultural appropriateness and linguistic accuracy.

3. Metaphor Interpretation (200-250 words):
   a) Describe how your system would interpret the following {t['name']} metaphor: "{t['example_metaphor']}".
   b) Explain the process of translating this metaphor into English or another language.
   c) Discuss potential challenges in preserving the original cultural meaning and connotations.

4. Training and Data Requirements (150-200 words):
   a) Outline the types of data needed to train your AI system for this specific culture.
   b) Discuss ethical considerations in data collection and use for this purpose.
   c) Propose methods to address potential biases in the training data.

5. Evaluation and Limitations (150-200 words):
   a) Suggest metrics or methods to evaluate the performance of your AI system.
   b) Discuss potential limitations or challenges specific to metaphor generation and interpretation for the {t['name']} culture.
   c) Propose ideas for future improvements or expansions of the system.

Ensure your response demonstrates a deep understanding of AI systems, natural language processing, linguistics, and cultural anthropology. Be innovative in your approach while maintaining scientific and technological plausibility. Your total response should be between 900-1150 words.

Format your response with clear headings for each section, numbered as above. Use appropriate subheadings for subsections."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The AI system design must be tailored to the {t['name']} culture, considering their language and key cultural concepts",
            "The system architecture should be logically consistent and technologically plausible",
            f"The response should provide a specific example of metaphor generation for the concept of '{t['abstract_idea']}'",
            f"The response should include an interpretation of the given {t['name']} metaphor: '{t['example_metaphor']}'",
            "The analysis should consider cultural appropriateness, linguistic accuracy, and ethical implications",
            "The response should discuss challenges and limitations specific to cross-cultural metaphor AI",
            "The proposed evaluation methods and future improvements should be relevant and insightful",
            "The response should demonstrate interdisciplinary knowledge integration",
            "The response should be formatted with clear headings for each section, numbered as instructed",
            "The total response should be between 900-1150 words"
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
