import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        concepts = [
            {
                "concept": "quantum entanglement",
                "field": "quantum physics",
                "target_audience": "high school students"
            },
            {
                "concept": "neural plasticity",
                "field": "neuroscience",
                "target_audience": "general public"
            },
            {
                "concept": "ecosystem resilience",
                "field": "ecology",
                "target_audience": "policymakers"
            }
        ]
        return {str(i+1): concept for i, concept in enumerate(random.sample(concepts, 2))}

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system that generates and interprets metaphors based on cognitive and neural principles, then use it to explain the concept of {t['concept']} to {t['target_audience']}. Your response should include:

1. System Architecture (250-300 words):
   a) Describe the main components of your AI system and their functions.
   b) Explain how your system incorporates cognitive and neural principles in metaphor generation and interpretation.
   c) Discuss any novel features that make your system particularly suited for handling {t['field']} concepts.

2. Metaphor Generation Process (200-250 words):
   a) Explain the step-by-step process your AI system uses to generate metaphors for {t['concept']}.
   b) Discuss how your system ensures the generated metaphors are appropriate for {t['target_audience']}.
   c) Describe any constraints or guidelines your system follows to maintain scientific accuracy.

3. Cognitive Basis (150-200 words):
   a) Discuss the cognitive theories or models of metaphor comprehension that inform your AI system's design.
   b) Explain how your system accounts for cultural and experiential factors in metaphor processing.

4. Example Output (200-250 words):
   a) Provide two distinct metaphors for {t['concept']} generated by your AI system.
   b) For each metaphor, explain its cognitive basis and how it relates to the target concept.
   c) Discuss how these metaphors would aid in understanding for {t['target_audience']}.

5. Interpretation and Evaluation (150-200 words):
   a) Describe how your AI system would interpret and evaluate the effectiveness of its generated metaphors.
   b) Propose a method to measure the impact of these metaphors on learning and comprehension for {t['target_audience']}.

6. Ethical Considerations (100-150 words):
   a) Discuss potential ethical implications of using AI-generated metaphors to explain scientific concepts.
   b) Propose guidelines for the responsible use of your system in educational or communication contexts.

Ensure your response demonstrates a deep understanding of cognitive science, linguistics, and artificial intelligence. Be innovative in your approach while maintaining scientific accuracy. Use appropriate terminology from all relevant fields.

Format your response with clear headings for each section and subsections where appropriate."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The response should include a detailed system architecture for an AI that generates and interprets metaphors for {t['concept']}.",
            f"The system should incorporate cognitive and neural principles in its design and operation.",
            f"The metaphor generation process should be clearly explained and appropriate for {t['target_audience']}.",
            f"The response should discuss relevant cognitive theories of metaphor comprehension.",
            f"Two distinct, AI-generated metaphors for {t['concept']} should be provided and explained.",
            "The response should include a method for interpreting and evaluating the effectiveness of the generated metaphors.",
            "Ethical considerations of using AI-generated metaphors for explaining scientific concepts should be addressed.",
            "The proposed AI system should demonstrate creativity and novelty in its approach to metaphor generation and interpretation."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
