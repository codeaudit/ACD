import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        cognitive_states = [
            "focused attention",
            "creative flow",
            "meditative state",
            "emotional arousal",
            "decision-making",
            "memory recall",
            "problem-solving"
        ]
        musical_elements = [
            "rhythm",
            "harmony",
            "timbre",
            "melody",
            "dynamics",
            "texture",
            "form"
        ]
        ai_techniques = [
            "neural networks",
            "evolutionary algorithms",
            "reinforcement learning",
            "generative adversarial networks",
            "transformer models",
            "recurrent neural networks",
            "deep belief networks"
        ]
        
        tasks = {
            "1": {
                "cognitive_state": random.choice(cognitive_states),
                "musical_element": random.choice(musical_elements),
                "ai_technique": random.choice(ai_techniques)
            },
            "2": {
                "cognitive_state": random.choice(cognitive_states),
                "musical_element": random.choice(musical_elements),
                "ai_technique": random.choice(ai_techniques)
            }
        }
        return tasks

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system that composes and analyzes music based on cognitive and emotional states, focusing on the cognitive state of {t['cognitive_state']}, the musical element of {t['musical_element']}, and using the AI technique of {t['ai_technique']}. Your response should include:

1. System Architecture (250-300 words):
   a) Describe the key components of your AI music composition and analysis system.
   b) Explain how your system integrates cognitive science, music theory, and AI principles.
   c) Detail how the system captures and represents the specified cognitive state.
   d) Discuss how the chosen AI technique is applied to musical composition and analysis.

2. Cognitive-Musical Mapping (200-250 words):
   a) Explain the theoretical framework for mapping {t['cognitive_state']} to musical parameters.
   b) Describe how your system translates cognitive and emotional data into musical elements, particularly {t['musical_element']}.
   c) Discuss any challenges in this mapping process and how your system addresses them.

3. Composition Process (200-250 words):
   a) Outline the step-by-step process of how your AI system composes music.
   b) Explain how {t['musical_element']} is specifically generated and manipulated.
   c) Describe how the system ensures musical coherence and emotional relevance.

4. Analysis Capabilities (200-250 words):
   a) Detail how your system analyzes existing music in relation to cognitive states.
   b) Explain the metrics or features used to correlate music with {t['cognitive_state']}.
   c) Describe a potential experiment to validate your system's analysis capabilities.

5. Concrete Example (150-200 words):
   a) Provide a specific example of a musical composition or analysis generated by your system.
   b) Explain how this example demonstrates the system's ability to capture {t['cognitive_state']} through {t['musical_element']}.
   c) Describe the expected emotional or cognitive response to this composition.

6. Ethical and Practical Implications (150-200 words):
   a) Discuss potential applications of your system in fields like therapy, education, or entertainment.
   b) Address ethical considerations, including privacy concerns and potential misuse.
   c) Propose guidelines for responsible development and use of cognitive music AI systems.

7. Technical Implementation (150-200 words):
   a) Describe how you would implement your system using {t['ai_technique']}.
   b) Discuss any technical challenges and propose solutions.
   c) Explain how you would evaluate the performance and effectiveness of your system.

8. Future Directions (100-150 words):
   a) Suggest two potential improvements or extensions to your system.
   b) Discuss how these changes could expand its capabilities or applications.

Ensure your response demonstrates a deep understanding of cognitive science, music theory, and artificial intelligence. Use appropriate technical terminology and provide clear explanations for complex concepts. Be innovative in your approach while maintaining scientific plausibility.

Format your response with clear headings for each section, numbered as above. Your total response should be between 1400-1800 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The response demonstrates a deep understanding of the cognitive state {t['cognitive_state']} and how it relates to music composition and perception",
            f"The system effectively incorporates {t['musical_element']} in its composition and analysis processes",
            f"The AI technique {t['ai_technique']} is well-integrated into the system design and its application is clearly explained",
            "The response shows creative and interdisciplinary thinking in combining cognitive science, music theory, and AI",
            "The ethical implications and future directions are thoughtfully explored and relevant to the proposed system",
            "A concrete example of a musical composition or analysis is provided and clearly explained"
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
