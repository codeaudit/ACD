import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        brain_regions = [
            {
                "region": "auditory cortex",
                "function": "processing and perception of sound"
            },
            {
                "region": "prefrontal cortex",
                "function": "executive functions, including planning and decision-making"
            },
            {
                "region": "hippocampus",
                "function": "memory formation and spatial navigation"
            },
            {
                "region": "amygdala",
                "function": "processing emotions and emotional memories"
            }
        ]
        return {
            "1": random.choice(brain_regions),
            "2": random.choice(brain_regions)
        }

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design a neural network model that generates music based on brain activity patterns, focusing on the {t['region']} and its role in {t['function']}. Then, analyze the potential applications and ethical implications of this technology. Your response should include the following sections:

1. Neural Network Model Design (300-350 words):
   a) Describe the architecture of your neural network model, including input layers, hidden layers, and output layers.
   b) Explain how your model processes brain activity data from the {t['region']} to generate musical elements.
   c) Discuss how you incorporate the function of {t['function']} into your model's music generation process.
   d) Provide a high-level pseudocode or flow diagram of your model's operation.

2. Brain-Music Interface (250-300 words):
   a) Explain the methods used to collect and preprocess brain activity data for your model.
   b) Describe how your model translates neural patterns into musical features (e.g., melody, rhythm, harmony).
   c) Discuss any challenges in mapping brain activity to musical elements and how you address them.

3. Music Generation and Analysis (200-250 words):
   a) Describe the expected characteristics of the music generated by your model.
   b) Explain how the {t['region']}'s function influences the generated music.
   c) Propose a method for evaluating the quality and uniqueness of the generated music.

4. Potential Applications (200-250 words):
   a) Suggest three innovative applications of your neuromusical AI composition system.
   b) Discuss how these applications could benefit fields such as neuroscience, music therapy, or artistic expression.
   c) Analyze potential challenges or limitations in implementing these applications.

5. Ethical Implications (250-300 words):
   a) Identify and discuss at least three ethical concerns related to using brain activity for music generation.
   b) Analyze the potential impact of this technology on privacy, creativity, and the nature of artistic expression.
   c) Propose guidelines for the responsible development and use of neuromusical AI composition systems.

6. Future Directions (150-200 words):
   a) Suggest two potential improvements or extensions to your model.
   b) Discuss how this technology might evolve in the next decade.
   c) Propose a novel research question that combines insights from your system with another scientific or artistic domain.

Ensure your response demonstrates a deep understanding of neuroscience, music theory, and artificial intelligence. Use appropriate technical terminology and provide clear explanations for complex concepts. Be innovative in your approach while maintaining scientific plausibility and ethical responsibility.

Format your response with clear headings for each section. Your total response should be between 1350-1650 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            "The response includes a well-designed neural network model that incorporates the specified brain region and its function.",
            "The brain-music interface is described in sufficient detail and addresses challenges in data collection and processing.",
            "The music generation and analysis section provides clear insights into the expected output and evaluation methods.",
            "The potential applications are innovative and well-justified.",
            "The ethical implications are thoroughly analyzed, with thoughtful guidelines proposed.",
            "The future directions suggest creative improvements and novel research questions.",
            "The response demonstrates a deep understanding of neuroscience, music theory, and artificial intelligence."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
