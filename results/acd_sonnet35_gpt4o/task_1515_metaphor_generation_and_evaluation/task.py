import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        abstract_concepts = [
            "time",
            "love",
            "justice",
            "knowledge",
            "freedom",
            "creativity"
        ]
        concrete_domains = [
            "nature",
            "technology",
            "food",
            "architecture",
            "sports",
            "music"
        ]
        return {
            "1": {
                "concept": random.choice(abstract_concepts),
                "domain": random.choice(concrete_domains)
            },
            "2": {
                "concept": random.choice(abstract_concepts),
                "domain": random.choice(concrete_domains)
            }
        }

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Generate and evaluate a novel metaphor based on conceptual blending theory, then analyze its cognitive and emotional impact. Your task involves the abstract concept of {t['concept']} and the concrete domain of {t['domain']}.

1. Metaphor Generation (200-250 words):
   a) Create a novel metaphor that expresses {t['concept']} in terms of {t['domain']}.
   b) Explain the conceptual blending process you used to generate this metaphor.
   c) Identify the source domain, target domain, and the key mappings between them.

2. Linguistic Analysis (200-250 words):
   a) Analyze the linguistic structure of your metaphor, including any syntactic or semantic patterns.
   b) Discuss how your metaphor extends or challenges conventional metaphorical expressions for {t['concept']}.
   c) Explain how your metaphor might be understood or interpreted across different cultures or languages.

3. Cognitive Impact (200-250 words):
   a) Analyze how your metaphor might influence cognitive processes related to understanding {t['concept']}.
   b) Discuss potential implications for conceptual structure and mental representations.
   c) Propose an experiment to test the cognitive effects of exposure to your metaphor.

4. Emotional Resonance (200-250 words):
   a) Evaluate the potential emotional impact of your metaphor on different audiences.
   b) Analyze how the metaphor might evoke specific emotions or emotional patterns.
   c) Discuss how the emotional impact might vary based on cultural or personal experiences.

5. Computational Creativity Assessment (200-250 words):
   a) Propose criteria for evaluating the creativity and novelty of metaphors generated by AI systems.
   b) Discuss challenges in computationally modeling the metaphor generation and evaluation process.
   c) Suggest potential applications of AI-generated metaphors in fields such as education, therapy, or artistic expression.

Ensure your response demonstrates a deep understanding of cognitive linguistics, emotion theory, and computational approaches to creativity. Use appropriate terminology and provide clear explanations for complex concepts. Be innovative in your metaphor generation while considering scientific plausibility in your analysis.

Format your response with clear headings for each section, numbered as above. Your total response should be between 1000-1250 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The response includes a novel metaphor expressing {t['concept']} in terms of {t['domain']}",
            "The conceptual blending process is clearly explained",
            "The linguistic analysis is thorough and insightful",
            "The cognitive and emotional impacts are thoughtfully analyzed",
            "The computational creativity assessment is well-reasoned and innovative",
            "The response demonstrates deep understanding of cognitive linguistics, emotion theory, and computational creativity"
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
