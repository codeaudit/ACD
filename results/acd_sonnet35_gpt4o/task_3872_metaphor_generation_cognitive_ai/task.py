import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        concepts = [
            {
                'source_domain': 'Ocean',
                'target_domain': 'Mind',
                'cultural_context': 'Western philosophy'
            },
            {
                'source_domain': 'Quantum mechanics',
                'target_domain': 'Social interactions',
                'cultural_context': 'Modern scientific society'
            }
        ]
        return {str(i+1): concept for i, concept in enumerate(random.sample(concepts, 2))}

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system capable of generating novel metaphors based on conceptual blending theory, then analyze the cognitive and cultural implications of the generated metaphors. Your task involves the following components:

1. AI System Architecture (300-350 words):
   a) Describe the key components of your AI system for metaphor generation and analysis.
   b) Explain how your system implements conceptual blending theory.
   c) Discuss any novel AI techniques or cognitive models used in your system.
   d) Include a high-level diagram or pseudocode illustrating the system's architecture (describe it textually).

2. Metaphor Generation Process (250-300 words):
   a) Explain how your AI system generates metaphors using the source domain '{t['source_domain']}' and the target domain '{t['target_domain']}'.
   b) Describe the key parameters and variables considered in the metaphor creation process.
   c) Discuss how your system ensures the generated metaphors are novel and meaningful.

3. Example Metaphor (200-250 words):
   a) Present a novel metaphor generated by your AI system using the given source and target domains.
   b) Provide a detailed explanation of how your system arrived at this metaphor.
   c) Analyze the cognitive implications of this metaphor, including potential insights or new perspectives it offers.

4. Cultural Analysis (250-300 words):
   a) Analyze the cultural implications of the generated metaphor within the context of {t['cultural_context']}.
   b) Discuss how the metaphor might be interpreted differently across various cultural contexts.
   c) Explain how your AI system accounts for cultural factors in metaphor generation and analysis.

5. Cognitive Impact Assessment (200-250 words):
   a) Propose a method to evaluate the cognitive impact of the generated metaphors on human understanding.
   b) Describe an experiment design to test the effectiveness of these metaphors in facilitating learning or problem-solving.
   c) Discuss potential cognitive biases or limitations that might affect metaphor interpretation.

6. Ethical Considerations (150-200 words):
   a) Identify at least three ethical concerns related to AI-generated metaphors and their potential influence on human cognition and culture.
   b) Propose guidelines for responsible development and use of metaphor-generating AI systems.
   c) Discuss the potential long-term implications of widespread use of AI-generated metaphors in society.

7. Future Directions (150-200 words):
   a) Suggest two potential improvements or extensions to your AI system.
   b) Propose a research question that explores the relationship between AI-generated metaphors and human creativity.
   c) Discuss how insights from this system could inform other areas of AI and cognitive science research.

Ensure your response demonstrates a deep understanding of cognitive science, artificial intelligence, linguistics, and cultural anthropology. Use appropriate technical terminology and provide clear explanations for complex concepts. Be creative and innovative in your approach while maintaining scientific plausibility.

Format your response with clear headings for each section, numbered as above. Your total response should be between 1500-1850 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            "The response addresses all required sections comprehensively.",
            "The proposed AI system for metaphor generation is innovative and scientifically plausible.",
            "The analysis demonstrates a deep understanding of conceptual blending theory and its application.",
            "The cultural and cognitive analyses are insightful and well-reasoned.",
            "The response shows creativity in metaphor generation and interpretation.",
            "Ethical considerations and future directions are thoughtfully addressed."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
