import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        domains = [
            'physics',
            'biology',
            'psychology',
            'economics',
            'art',
            'music',
            'literature',
            'mathematics'
        ]
        problem_types = [
            'scientific discovery',
            'technological innovation',
            'social issue resolution',
            'artistic creation',
            'philosophical inquiry'
        ]
        
        tasks = {
            "1": {
                "domain1": random.choice(domains),
                "domain2": random.choice(domains),
                "problem_type": random.choice(problem_types)
            },
            "2": {
                "domain1": random.choice(domains),
                "domain2": random.choice(domains),
                "problem_type": random.choice(problem_types)
            }
        }
        
        # Ensure the two tasks are different
        while tasks["1"] == tasks["2"]:
            tasks["2"] = {
                "domain1": random.choice(domains),
                "domain2": random.choice(domains),
                "problem_type": random.choice(problem_types)
            }
        
        return tasks

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system capable of performing advanced conceptual blending across different domains, and apply it to solve a complex interdisciplinary problem. Your task involves blending concepts from {t['domain1']} and {t['domain2']} to address a problem in the area of {t['problem_type']}. Your response should include:

1. Conceptual Blending System Design (300-350 words):
   a) Describe the architecture of your AI system for conceptual blending.
   b) Explain how your system represents and processes knowledge from different domains.
   c) Detail the mechanisms used to identify and combine relevant concepts.
   d) Discuss how your system evaluates and refines the blended concepts.
   e) Provide a visual representation or diagram of your conceptual blending system (describe it textually).

2. Knowledge Representation (200-250 words):
   a) Explain how your system represents knowledge from {t['domain1']} and {t['domain2']}.
   b) Describe any ontologies, semantic networks, or other structures used.
   c) Discuss how your system handles domain-specific terminology and concepts.
   d) Provide an example of how a specific concept from each domain would be represented in your system.

3. Blending Process (250-300 words):
   a) Provide a step-by-step explanation of how your system blends concepts from {t['domain1']} and {t['domain2']}.
   b) Describe any heuristics or algorithms used in the blending process.
   c) Explain how your system handles conflicts or incompatibilities between domains.
   d) Discuss how emergent properties are identified and developed in the blended space.
   e) Illustrate the blending process with a specific example using concepts from {t['domain1']} and {t['domain2']}.

4. Application to {t['problem_type']} (250-300 words):
   a) Describe a specific problem in {t['problem_type']} that your system addresses. For example, if the problem type is 'scientific discovery', you might focus on developing a new theory that explains dark matter using concepts from quantum mechanics and fluid dynamics.
   b) Explain how the blended concepts from {t['domain1']} and {t['domain2']} contribute to the solution.
   c) Provide a detailed example of a novel insight or solution generated by your system.
   d) Discuss the potential impact of this solution in the field of {t['problem_type']}.
   e) Consider and discuss any potential emergent properties or unexpected outcomes that might arise from your conceptual blend.

5. Evaluation and Validation (200-250 words):
   a) Propose methods to evaluate the creativity and effectiveness of your system's conceptual blends.
   b) Describe how you would validate the relevance and feasibility of the generated solutions.
   c) Discuss potential limitations of your approach and suggest improvements.
   d) Propose a hypothetical experiment to empirically test the effectiveness of your conceptual blending system.

6. Ethical Considerations and Future Directions (150-200 words):
   a) Discuss ethical implications of using AI for conceptual blending and interdisciplinary problem-solving.
   b) Address potential biases in your system and propose strategies to mitigate them.
   c) Suggest future research directions to enhance AI-driven conceptual blending.
   d) Speculate on how advances in quantum computing or neuromorphic hardware might impact your system's capabilities.

7. Glossary of Key Terms (100-150 words):
   Provide a brief glossary defining 5-7 key terms used in your response. These should be central concepts in your conceptual blending system or the domains involved.

Ensure your response demonstrates a deep understanding of conceptual blending theory, knowledge representation, and the specific domains involved. Use appropriate technical terminology and provide clear explanations for complex concepts. Be innovative in your approach while maintaining scientific plausibility and coherence across all sections of your response.

Format your response with clear headings for each section and subsections labeled a, b, c, d, e as appropriate. Adhere strictly to the word count for each section. Your total response should be between 1450-1800 words.

Remember to maintain scientific plausibility throughout your response, even when proposing innovative solutions. Your conceptual blending system should be grounded in current understanding of AI and cognitive science while pushing the boundaries of what's possible."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The response demonstrates a deep understanding of conceptual blending theory and its application to AI systems.",
            f"The proposed AI system effectively blends concepts from {t['domain1']} and {t['domain2']} to address a problem in {t['problem_type']}.",
            "The knowledge representation and blending process are well-explained and scientifically plausible.",
            "The application example provides a novel and relevant solution to the specified problem.",
            "The response addresses evaluation, validation, and ethical considerations adequately.",
            "The answer is well-structured, clear, and uses appropriate technical terminology from the relevant domains.",
            "The response includes a visual representation or diagram of the conceptual blending system.",
            "The response adheres to the specified word count for each section and the overall word limit.",
            "The glossary of key terms demonstrates a clear understanding of the central concepts used in the response.",
            "The response considers potential emergent properties or unexpected outcomes of the conceptual blending process.",
            "The proposed hypothetical experiment is well-designed and relevant to testing the effectiveness of the conceptual blending system."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
