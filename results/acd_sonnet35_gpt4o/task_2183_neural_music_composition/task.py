import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        brain_regions = ['prefrontal cortex', 'auditory cortex', 'hippocampus', 'amygdala', 'cerebellum']
        musical_elements = ['melody', 'harmony', 'rhythm', 'timbre', 'dynamics']
        ai_techniques = ['deep learning', 'reinforcement learning', 'generative adversarial networks', 'transformer models', 'recurrent neural networks']
        
        return {
            "1": {
                "brain_region": random.choice(brain_regions),
                "musical_element": random.choice(musical_elements),
                "ai_technique": random.choice(ai_techniques)
            },
            "2": {
                "brain_region": random.choice(brain_regions),
                "musical_element": random.choice(musical_elements),
                "ai_technique": random.choice(ai_techniques)
            }
        }

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system that composes music by interpreting and translating neural activity patterns from the {t['brain_region']}, focusing on the musical element of {t['musical_element']}, and using {t['ai_technique']} as the primary AI technique. Your response should include the following sections:

1. System Architecture (250-300 words):
   a) Describe the key components of your AI system for neural music composition.
   b) Explain how your system interfaces with and interprets neural activity from the {t['brain_region']}.
   c) Detail how the system translates neural patterns into musical elements, particularly {t['musical_element']}.
   d) Discuss how {t['ai_technique']} is implemented in your system's design.

2. Neural-Musical Mapping (200-250 words):
   a) Explain the theoretical basis for mapping neural activity from the {t['brain_region']} to {t['musical_element']}.
   b) Describe any novel algorithms or techniques you've developed for this mapping.
   c) Discuss how your system handles variability and noise in neural signals.

3. Music Generation Process (200-250 words):
   a) Outline the step-by-step process of how your AI system generates a musical composition.
   b) Explain how {t['ai_technique']} is used in the composition process.
   c) Describe how your system ensures musical coherence and aesthetic quality.

4. Neuroscientific Implications (150-200 words):
   a) Discuss what your system's music generation process might reveal about the role of the {t['brain_region']} in musical creativity.
   b) Propose a hypothesis about brain function that could be tested using your system.

5. Artistic and Cognitive Analysis (150-200 words):
   a) Analyze the potential artistic value of the music generated by your system.
   b) Discuss how this approach to music composition might influence our understanding of human creativity.

6. Ethical Considerations (100-150 words):
   a) Identify potential ethical issues in using neural data for artistic creation.
   b) Propose guidelines for the responsible development and use of such technology.

7. Future Developments (100-150 words):
   a) Suggest two potential extensions or applications of your system.
   b) Briefly describe how these developments could contribute to neuroscience or musicology.

Ensure your response demonstrates a deep understanding of neuroscience, music theory, and artificial intelligence. Use appropriate technical terminology and provide clear explanations where necessary. Be innovative in your approach while maintaining scientific and artistic plausibility.

Format your response with clear headings for each section. Your total response should be between 1150-1500 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The system architecture clearly incorporates neural activity interpretation from the {t['brain_region']}, focuses on {t['musical_element']}, and uses {t['ai_technique']}.",
            "The response demonstrates a deep understanding of neuroscience, music theory, and artificial intelligence.",
            "The neural-musical mapping and music generation process are innovative yet scientifically plausible.",
            "The response addresses all required sections with appropriate detail and length.",
            "The analysis of neuroscientific implications and artistic value is insightful and well-reasoned.",
            "Ethical considerations are thoughtfully explored and addressed.",
            "The proposed future developments are creative and potentially impactful.",
            "The total response is between 1150-1500 words."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
