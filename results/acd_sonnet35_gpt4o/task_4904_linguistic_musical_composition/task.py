import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        linguistic_features = [
            "syntax",
            "phonology",
            "semantics",
            "pragmatics"
        ]
        musical_elements = [
            "melody",
            "harmony",
            "rhythm",
            "timbre"
        ]
        texts = [
            "The quick brown fox jumps over the lazy dog.",
            "To be, or not to be, that is the question.",
            "I have a dream that one day this nation will rise up.",
            "In the beginning God created the heavens and the earth."
        ]
        tasks = {}
        for i in range(2):
            tasks[str(i+1)] = {
                "linguistic_feature": random.choice(linguistic_features),
                "musical_element": random.choice(musical_elements),
                "text": random.choice(texts)
            }
        return tasks

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design a system that translates linguistic structures into musical compositions, focusing on the linguistic feature of {t['linguistic_feature']} and the musical element of {t['musical_element']}. Then, use your system to create and analyze a musical piece based on the following text: "{t['text']}"

Your response should include the following sections:

1. System Design (300-350 words):
   a) Describe the overall architecture of your linguistic-musical translation system.
   b) Explain how your system maps {t['linguistic_feature']} to {t['musical_element']}.
   c) Discuss any novel algorithms or techniques used in your system.
   d) Provide a diagram or pseudocode snippet illustrating a key component of your system.

2. Linguistic Analysis (200-250 words):
   a) Analyze the given text, focusing on its {t['linguistic_feature']} features.
   b) Explain how these features will be represented in your musical composition.
   c) Discuss any challenges in translating these linguistic elements to music.

3. Musical Composition (250-300 words):
   a) Describe the musical piece generated by your system based on the given text.
   b) Explain how the {t['musical_element']} in your composition reflects the text's {t['linguistic_feature']}.
   c) Provide a short musical notation (using standard notation, tablature, or a clear textual description) of a key passage in your composition, and explain how it relates to a specific linguistic feature in the text.

4. Comparative Analysis (200-250 words):
   a) Compare your linguistic-musical translation approach to traditional methods of text-to-music conversion.
   b) Discuss potential advantages and limitations of your system.
   c) Explain how your system might provide new insights into the relationship between language and music.

5. Cognitive and Aesthetic Implications (150-200 words):
   a) Discuss how your system might influence our understanding of language processing and musical cognition.
   b) Explore the potential aesthetic value of compositions created through linguistic-musical translation.

6. Future Directions and Applications (150-200 words):
   a) Propose potential improvements or extensions to your system.
   b) Suggest two novel applications of your linguistic-musical translation system outside of artistic composition.

Ensure your response demonstrates a deep understanding of both linguistics and music theory. Use appropriate terminology from both fields and provide clear explanations for complex concepts. Be creative in your approach while maintaining scientific plausibility.

Format your response with clear headings for each section, numbered as above. Your total response should be between 1250-1550 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The response should include a clear explanation of how {t['linguistic_feature']} is mapped to {t['musical_element']}",
            "The system design should be innovative and well-explained, with a diagram or pseudocode provided",
            f"The linguistic analysis should focus on the {t['linguistic_feature']} of the given text",
            f"The musical composition description should clearly relate to the text's {t['linguistic_feature']}",
            "The response should include a musical notation or clear textual description of a key passage, with an explanation of how it relates to the text",
            "The comparative analysis should provide thoughtful insights into the advantages and limitations of the system",
            "The response should demonstrate a deep understanding of both linguistics and music theory",
            "The proposed future directions and applications should be creative and plausible",
            "The response should be well-structured with clear headings and subheadings as specified in the instructions",
            "The overall proposed system should be coherent and feasible, demonstrating a logical connection between linguistic features and musical elements"
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
