import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        abstract_concepts = [
            "quantum entanglement",
            "dark matter",
            "neural plasticity",
            "climate feedback loops"
        ]
        source_domains = [
            "dance",
            "cooking",
            "architecture",
            "music"
        ]
        tasks = {}
        for i in range(2):
            tasks[str(i+1)] = {
                "abstract_concept": random.choice(abstract_concepts),
                "source_domain": random.choice(source_domains)
            }
        return tasks

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system that generates and interprets metaphors using conceptual blending theory, then apply it to create a novel metaphor for the abstract scientific concept of {t['abstract_concept']} using the source domain of {t['source_domain']}. Your response should include:

1. Conceptual Blending System Design (250-300 words):
   a) Describe the key components of your AI system for conceptual blending and metaphor generation.
   b) Explain how your system implements the main principles of conceptual blending theory.
   c) Discuss how your system handles the selection and integration of input spaces.
   d) Outline any novel approaches or extensions to conceptual blending theory in your design.

2. Metaphor Generation Process (200-250 words):
   a) Explain how your system would generate a metaphor for {t['abstract_concept']} using {t['source_domain']}.
   b) Describe the input spaces, generic space, and blended space involved in this process.
   c) Discuss any challenges specific to blending these particular domains and how your system addresses them.

3. Generated Metaphor (100-150 words):
   a) Present the metaphor generated by your system for {t['abstract_concept']} using {t['source_domain']}.
   b) Explain the key mappings and emergent structure in the blended space.
   c) Discuss how this metaphor illuminates or provides new insights into the abstract concept.

4. Metaphor Interpretation (200-250 words):
   a) Describe how your system would interpret and analyze the generated metaphor.
   b) Explain how it identifies entailments and inferences from the blended space.
   c) Discuss any potential limitations or misunderstandings that could arise from this metaphor.

5. Cognitive and AI Implications (200-250 words):
   a) Analyze what your system's metaphor generation process suggests about human cognitive processes.
   b) Discuss potential applications of your conceptual blending system in AI development.
   c) Explore how this approach to metaphor generation could enhance AI's understanding of abstract concepts.

6. Ethical Considerations (150-200 words):
   a) Discuss potential ethical implications of using AI-generated metaphors to explain scientific concepts.
   b) Consider how metaphors might influence public understanding and perception of science.
   c) Propose guidelines for the responsible use of AI-generated metaphors in scientific communication.

Ensure your response demonstrates a deep understanding of conceptual blending theory, cognitive linguistics, and the chosen scientific concept. Be creative in your metaphor generation while maintaining scientific accuracy and plausibility. Use appropriate terminology from relevant fields and provide clear explanations of complex ideas.

Format your response with clear headings for each section. Your total response should be between 1100-1400 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            "The response demonstrates a clear understanding of conceptual blending theory and its application to metaphor generation.",
            "The AI system design is well-explained and incorporates key principles of conceptual blending.",
            "The generated metaphor for the given abstract concept using the specified source domain is creative and insightful.",
            "The analysis of the metaphor and its implications for cognitive science and AI is thorough and well-reasoned.",
            "The response addresses ethical considerations and proposes thoughtful guidelines for using AI-generated metaphors in scientific communication."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
