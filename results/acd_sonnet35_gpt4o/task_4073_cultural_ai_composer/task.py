import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        cultural_traditions = [
            "West African Griot",
            "Indian Classical",
            "Andean Folk",
            "Celtic",
            "Japanese Gagaku"
        ]
        musical_elements = [
            "Rhythm and Meter",
            "Melody and Scale",
            "Harmony and Tonality",
            "Timbre and Instrumentation"
        ]
        modern_genres = [
            "Electronic Dance Music",
            "Jazz Fusion",
            "Ambient",
            "Hip Hop",
            "Progressive Rock"
        ]
        return {
            "1": {
                "cultural_tradition": random.choice(cultural_traditions),
                "musical_element": random.choice(musical_elements),
                "modern_genre": random.choice(modern_genres)
            },
            "2": {
                "cultural_tradition": random.choice(cultural_traditions),
                "musical_element": random.choice(musical_elements),
                "modern_genre": random.choice(modern_genres)
            }
        }

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system that generates original music compositions inspired by {t['cultural_tradition']} tradition, with a focus on {t['musical_element']}, and create a fusion with {t['modern_genre']}. Your response should adhere to the METR Standard, which requires a clear structure and specific word counts for each section.

Include the following sections in your response:

1. AI System Architecture (300-325 words):
   a) Describe the key components of your AI music composition system.
   b) Explain how your system incorporates cultural knowledge about {t['cultural_tradition']} tradition.
   c) Detail how the system focuses on {t['musical_element']} in its compositions.
   d) Discuss how your system creates a fusion with {t['modern_genre']}.
   e) Include a high-level diagram or pseudocode to illustrate your architecture.

2. Cultural and Musical Analysis (250-275 words):
   a) Analyze the key characteristics of {t['cultural_tradition']} musical tradition.
   b) Explain the significance of {t['musical_element']} in this tradition.
   c) Discuss how these elements can be effectively combined with {t['modern_genre']}.
   d) Identify potential challenges in creating an authentic fusion of these styles.

3. Machine Learning Approach (250-275 words):
   a) Describe the machine learning techniques your system uses for music generation.
   b) Explain how you would train your model on {t['cultural_tradition']} music.
   c) Discuss how your system balances adherence to traditional rules with creative innovation.
   d) Propose a method for evaluating the cultural authenticity and musical quality of the generated compositions.

4. Sample Composition Description (200-225 words):
   a) Describe a hypothetical composition generated by your AI system.
   b) Explain how it incorporates elements from {t['cultural_tradition']} and {t['modern_genre']}.
   c) Detail how the composition showcases {t['musical_element']}.
   d) Discuss how this composition demonstrates both cultural authenticity and innovative fusion.

5. Ethical Considerations and Cultural Sensitivity (200-225 words):
   a) Discuss potential ethical issues in using AI to generate culturally-inspired music.
   b) Address concerns about cultural appropriation and respect for traditional art forms.
   c) Propose guidelines for the responsible development and use of AI in cultural music fusion.
   d) Discuss how your system can promote cultural appreciation and exchange.

6. Future Developments and Applications (150-175 words):
   a) Propose two potential advancements or extensions of your AI music composition system.
   b) Discuss how this technology might impact the music industry and cultural preservation efforts.
   c) Suggest a research question that could further explore the intersection of AI, music, and cultural studies.

Ensure your response demonstrates a deep understanding of music theory, cultural studies, and AI principles. Use appropriate musical and technical terminology, providing explanations where necessary. Be innovative in your approach while maintaining cultural sensitivity and musical plausibility.

Include at least three relevant citations or references to academic sources, experts, or reputable publications to support your arguments and demonstrate depth of knowledge.

Format your answer with clear headings for each section and include a word count at the end of each section. Your total response should be between 1350-1500 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The response demonstrates a deep understanding of {t['cultural_tradition']} musical tradition",
            f"The AI system effectively incorporates {t['musical_element']} in its composition process",
            f"The design successfully creates a fusion between {t['cultural_tradition']} and {t['modern_genre']}",
            "The proposed AI architecture is innovative yet plausible",
            "The response shows cultural sensitivity and addresses ethical considerations",
            "The sample composition description is creative and demonstrates a clear understanding of the fusion concept",
            "The response includes all required sections and adheres to the specified word count ranges",
            "The response includes at least three relevant citations or references"
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
