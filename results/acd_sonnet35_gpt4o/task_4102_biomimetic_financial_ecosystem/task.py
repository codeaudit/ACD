import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        ecological_processes = [
            "Symbiosis",
            "Predator-Prey Dynamics",
            "Nutrient Cycling",
            "Succession",
            "Adaptive Radiation"
        ]
        market_phenomena = [
            "Market Crashes",
            "Bubble Formation",
            "Sector Rotation",
            "Algorithmic Trading",
            "Regulatory Impact"
        ]
        financial_challenges = [
            "Incorporating blockchain technology",
            "Addressing climate-related financial risks",
            "Optimizing high-frequency trading",
            "Mitigating systemic risk",
            "Enhancing financial inclusion"
        ]
        return {
            "1": {
                "ecological_process": random.choice(ecological_processes),
                "market_phenomenon": random.choice(market_phenomena),
                "financial_challenge": random.choice(financial_challenges)
            },
            "2": {
                "ecological_process": random.choice(ecological_processes),
                "market_phenomenon": random.choice(market_phenomena),
                "financial_challenge": random.choice(financial_challenges)
            }
        }

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design a biomimetic financial ecosystem inspired by the ecological process of {t['ecological_process']}, then use it to model and analyze the market phenomenon of {t['market_phenomenon']} while addressing the financial challenge of {t['financial_challenge']}. Your response should include:

1. Ecological Process Analysis (200-250 words):
   a) Explain the key principles and mechanisms of {t['ecological_process']} in natural ecosystems.
   b) Discuss how these principles could be applied to financial markets.
   c) Identify potential analogies between ecological and financial system components.

2. Biomimetic Financial Ecosystem Design (300-350 words):
   a) Describe the main components of your biomimetic financial ecosystem.
   b) Explain how your design incorporates the principles of {t['ecological_process']}.
   c) Detail the interactions and relationships between different elements in your system.
   d) Discuss how your design addresses the challenge of {t['financial_challenge']}.
   e) Provide a visual representation of your ecosystem using ASCII art (minimum 15 lines) or a detailed text description (minimum 150 words).

3. Mathematical Modeling (200-250 words):
   a) Propose a mathematical framework to model your biomimetic financial ecosystem.
   b) Explain key variables, parameters, and relationships in your model.
   c) Discuss how your model captures both ecological and financial dynamics.
   d) Provide a simple equation or pseudocode (5-10 lines) illustrating a core aspect of your model.

4. Market Phenomenon Analysis (250-300 words):
   a) Apply your biomimetic model to analyze the phenomenon of {t['market_phenomenon']}.
   b) Explain how your model simulates or predicts this market behavior.
   c) Compare your biomimetic approach to traditional methods of analyzing this phenomenon.
   d) Discuss any insights or novel predictions generated by your model.

5. Practical Applications and Limitations (200-250 words):
   a) Propose potential real-world applications of your biomimetic financial ecosystem.
   b) Discuss how it could be used by financial institutions, regulators, or investors.
   c) Analyze limitations or potential issues with your approach.
   d) Suggest ways to validate and refine your model using real market data.

6. Ethical Implications and Unintended Consequences (200-250 words):
   a) Discuss ethical considerations in applying ecological principles to financial markets.
   b) Identify and analyze potential unintended consequences or risks of implementing your model.
   c) Propose strategies to mitigate these risks and ensure responsible use of your biomimetic approach.
   d) Suggest future research directions to address ethical concerns and improve the model's robustness.

Ensure your response demonstrates a deep understanding of both ecological processes and financial markets. Use appropriate technical terminology from both fields and provide clear explanations for complex concepts. Be innovative in your approach while maintaining scientific and economic plausibility.

Format your response with clear headings for each section. Your total response should be between 1350-1650 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The response demonstrates a clear understanding of {t['ecological_process']} and how it can be applied to financial markets",
            "The biomimetic financial ecosystem design is innovative, comprehensive, and economically plausible",
            f"The analysis of {t['market_phenomenon']} using the biomimetic model is thorough and insightful",
            "The mathematical modeling approach is well-explained and appropriate for the designed system",
            "The response shows a deep integration of knowledge from ecology and finance",
            f"The design effectively addresses the challenge of {t['financial_challenge']}",
            "The visual representation (ASCII art or text description) of the ecosystem is clear and informative",
            "The practical applications, limitations, and ethical implications are thoughtfully considered and discussed",
            "The response identifies and analyzes potential unintended consequences or risks of the model"
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
