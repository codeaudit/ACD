import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        scents = ['lavender', 'cinnamon', 'petrichor', 'freshly cut grass', 'sea breeze']
        emotions = ['nostalgia', 'comfort', 'excitement', 'tranquility', 'melancholy']
        memory_types = ['episodic', 'semantic', 'autobiographical', 'implicit', 'procedural']
        
        task1 = {
            "scent": random.choice(scents),
            "emotion": random.choice(emotions),
            "memory_type": random.choice(memory_types)
        }
        
        task2 = {
            "scent": random.choice([s for s in scents if s != task1["scent"]]),
            "emotion": random.choice([e for e in emotions if e != task1["emotion"]]),
            "memory_type": random.choice([m for m in memory_types if m != task1["memory_type"]])
        }
        
        return {"1": task1, "2": task2}

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system that models human olfactory processing and its connection to memory and emotion, then use it to generate and analyze novel scent-memory-emotion associations. Focus on the following scenario:

Scent: {t['scent']}
Emotion: {t['emotion']}
Memory Type: {t['memory_type']}

Your task has the following parts:

1. Olfactory AI System Architecture (300-350 words):
   a) Describe the overall structure of your AI system, including its main components and their functions.
   b) Explain how the system models the olfactory processing pathway, from odor reception to higher-level cognitive processing.
   c) Detail how your system integrates olfactory information with emotional processing and memory formation/retrieval.
   d) Discuss any novel AI techniques or algorithms used in your system design.

2. Scent-Memory-Emotion Mapping (250-300 words):
   a) Explain how your system represents and processes the given scent, emotion, and memory type.
   b) Describe the mechanism by which your AI generates associations between these elements.
   c) Discuss how your system accounts for individual differences in scent perception and emotional responses.

3. Novel Association Generation (200-250 words):
   a) Use your AI system to generate a novel, specific memory associated with the given scent and emotion.
   b) Explain the process by which your system created this association.
   c) Analyze the plausibility and uniqueness of the generated association.

4. Reverse Engineering (200-250 words):
   a) Describe how your system would work backwards from a given memory to predict associated scents and emotions.
   b) Provide an example using the memory type specified in the scenario.
   c) Discuss potential applications of this reverse engineering capability.

5. Comparative Analysis (150-200 words):
   a) Compare your AI's olfactory processing model to human olfactory processing.
   b) Discuss potential advantages and limitations of your AI approach.
   c) Explain how your system might provide insights into human olfactory perception and memory formation.

6. Ethical Implications and Future Directions (150-200 words):
   a) Discuss ethical considerations related to AI systems that model and manipulate sensory-emotional experiences.
   b) Propose two potential applications of your AI system in fields such as psychology, neuroscience, or aromatherapy.
   c) Suggest future research directions that could enhance the capabilities of olfactory-based AI systems.

Ensure your response demonstrates a deep understanding of olfactory neuroscience, emotional processing, memory systems, and AI technologies. Use appropriate technical terminology and provide clear explanations for complex concepts. Be creative in your approach while maintaining scientific plausibility.

Format your response with clear headings for each section. Your total response should be between 1250-1550 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            "The response demonstrates a deep understanding of olfactory neuroscience, emotional processing, memory systems, and AI technologies.",
            "The proposed AI system architecture is innovative and plausible.",
            "The scent-memory-emotion mapping mechanism is well-explained and scientifically grounded.",
            "The novel association generated by the AI system is creative and plausible.",
            "The reverse engineering process is logically described and demonstrates the system's capabilities.",
            "The comparative analysis shows insight into both AI and human cognitive processes.",
            "Ethical implications are thoughtfully considered and future directions are innovative.",
            "The response maintains scientific rigor while being creative and innovative.",
            "The response follows the specified format with clear headings for each section.",
            "The total word count is within the specified range (1250-1550 words)."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
