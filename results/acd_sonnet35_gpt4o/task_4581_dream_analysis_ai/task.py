import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        psychological_theories = [
            "Freudian psychoanalysis",
            "Jungian archetypes",
            "Cognitive theory",
            "Activation-synthesis hypothesis"
        ]
        dream_scenarios = [
            "Flying over a city of mirrors",
            "Chasing a talking animal through a labyrinth",
            "Attending a party where everyone wears masks",
            "Exploring an underwater library"
        ]
        return {
            "1": {
                "theory": random.choice(psychological_theories),
                "scenario": random.choice(dream_scenarios),
                "mode": "analyze"
            },
            "2": {
                "theory": random.choice(psychological_theories),
                "mode": "generate"
            }
        }

    @staticmethod
    def get_instructions(t: dict) -> str:
        if t['mode'] == 'analyze':
            return f"""Design an AI system capable of analyzing dream-like narratives based on psychological theories and linguistic patterns. Then, use your system to analyze the following dream scenario using the principles of {t['theory']}:

"{t['scenario']}"

Your response should include:

1. AI System Design (250-300 words):
   a) Describe the key components of your AI system for dream analysis.
   b) Explain how your system incorporates principles from {t['theory']}.
   c) Detail how your system processes and interprets symbolic and ambiguous language.

2. Dream Analysis (300-350 words):
   a) Provide a detailed interpretation of the given dream scenario using your AI system.
   b) Explain how specific elements of the dream relate to concepts in {t['theory']}.
   c) Discuss any potential symbolic meanings or hidden significance in the dream narrative.

3. Linguistic Pattern Recognition (200-250 words):
   a) Identify and explain any recurring linguistic patterns or structures in the dream narrative.
   b) Discuss how these patterns might contribute to the dream's meaning or emotional impact.
   c) Describe how your AI system recognizes and interprets these patterns.

4. Comparative Analysis (150-200 words):
   a) Compare your AI system's interpretation to how a human expert in {t['theory']} might analyze the dream.
   b) Discuss any advantages or limitations of using AI for dream analysis in this context.

Ensure your response demonstrates a deep understanding of the chosen psychological theory and natural language processing techniques. Be creative and insightful in your analysis while maintaining scientific plausibility."""
        else:
            return f"""Design an AI system capable of generating dream-like narratives based on psychological theories and linguistic patterns. Then, use your system to generate a new dream scenario inspired by the principles of {t['theory']}.

Your response should include:

1. AI System Design (250-300 words):
   a) Describe the key components of your AI system for dream generation.
   b) Explain how your system incorporates principles from {t['theory']}.
   c) Detail how your system creates symbolic and ambiguous language typical of dreams.

2. Dream Generation (300-350 words):
   a) Present a new dream scenario generated by your AI system (150-200 words).
   b) Explain how specific elements of the generated dream relate to concepts in {t['theory']}.
   c) Discuss the intended symbolic meanings or significance in the dream narrative.

3. Linguistic Pattern Creation (200-250 words):
   a) Identify and explain the linguistic patterns or structures used in the generated dream narrative.
   b) Discuss how these patterns contribute to the dream's meaning or emotional impact.
   c) Describe how your AI system creates and incorporates these patterns.

4. Evaluation and Reflection (150-200 words):
   a) Propose a method to evaluate the quality and authenticity of the AI-generated dream narrative.
   b) Discuss potential applications of your dream generation system in psychology, creativity, or other fields.
   c) Reflect on any ethical considerations in using AI to generate dream-like experiences.

Ensure your response demonstrates a deep understanding of the chosen psychological theory and natural language generation techniques. Be creative and insightful in your dream generation while maintaining scientific plausibility."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            "The response demonstrates a deep understanding of the specified psychological theory.",
            "The AI system design is well-explained and incorporates relevant principles.",
            "The dream analysis or generation is creative, insightful, and plausible.",
            "The linguistic patterns are clearly identified and explained.",
            "The response addresses all required sections with appropriate depth."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0