import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        musical_traditions = [
            "Western classical",
            "Indian classical (Hindustani)",
            "West African polyrhythmic",
            "Chinese pentatonic"
        ]
        cognitive_aspects = [
            "Expectation and surprise",
            "Emotional response",
            "Memory and recognition",
            "Attention and salience"
        ]
        tasks = {}
        for i in range(1, 3):
            tradition = random.choice(musical_traditions)
            aspect = random.choice(cognitive_aspects)
            comparison_tradition = random.choice([t for t in musical_traditions if t != tradition])
            tasks[str(i)] = {"tradition": tradition, "aspect": aspect, "comparison": comparison_tradition}
        return tasks

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"Design and analyze a cognitive model that represents harmonic progressions in {t['tradition']} music as multidimensional landscapes, focusing on the cognitive aspect of {t['aspect']}. Then, use this model to generate a novel composition and explore cross-cultural musical cognition. Your response should include:\n\n1. Cognitive Model Design (300-350 words):\n   a) Describe the key components of your cognitive model for representing harmonic progressions as multidimensional landscapes.\n   b) Explain how your model incorporates the specific cognitive aspect of {t['aspect']}.\n   c) Detail how your model accounts for the unique characteristics of {t['tradition']} music.\n   d) Include a visual representation (using ASCII art) or detailed textual description of your model's architecture.\n\n2. Mathematical Formulation (200-250 words):\n   a) Provide a mathematical representation of your cognitive harmonic landscape model.\n   b) Explain how harmonic progressions are mapped onto the multidimensional space.\n   c) Describe how the model quantifies the cognitive aspect of {t['aspect']}.\n\n3. Novel Composition Generation (250-300 words):\n   a) Explain the process of using your model to generate a novel composition in the {t['tradition']} style.\n   b) Describe a short (8-16 measure) composition generated by your model, highlighting its unique features. (Note: A measure, also known as a bar, is a segment of time in music containing a specific number of beats.)\n   c) Analyze how the generated composition reflects both the harmonic principles of {t['tradition']} music and the cognitive aspect of {t['aspect']}.\n\n4. Cross-Cultural Analysis (200-250 words):\n   a) Compare and contrast how your model would represent harmonic progressions from {t['tradition']} music versus {t['comparison']} music.\n   b) Discuss how these differences reflect variations in musical cognition across cultures.\n   c) Propose a hypothesis about universal versus culture-specific aspects of harmonic cognition based on your model.\n\n5. Cognitive Science Implications (150-200 words):\n   a) Discuss how your model contributes to our understanding of musical cognition, particularly in relation to {t['aspect']}.\n   b) Propose an experiment to test a key prediction of your model about human perception or cognition of harmony.\n\n6. AI and Creativity Discussion (150-200 words):\n   a) Analyze the creative potential and limitations of using AI models like yours for musical composition.\n   b) Discuss ethical considerations related to AI-generated music in the context of cultural traditions.\n\n7. Future Directions (100-150 words):\n   a) Propose two potential extensions or applications of your cognitive harmonic landscape model.\n   b) Suggest areas for future research that could enhance our understanding of musical cognition and AI-assisted composition.\n\nEnsure your response demonstrates a deep understanding of music theory, cognitive science, and artificial intelligence. Be innovative in your approach while maintaining scientific plausibility. Use appropriate technical terminology and provide clear explanations for complex concepts.\n\nFormat your response with clear headings for each section and subsections labeled a, b, c as appropriate. Your total response should be between 1350-1700 words. Include a word count at the end of your response."

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The response demonstrates a deep understanding of {t['tradition']} music and its harmonic principles",
            f"The cognitive model effectively incorporates the aspect of {t['aspect']} in musical cognition",
            "The mathematical formulation is sound and accurately represents the cognitive harmonic landscape model",
            "The generated composition reflects both the harmonic principles of the given musical tradition and the specified cognitive aspect",
            f"The cross-cultural analysis provides insightful comparisons between {t['tradition']} and {t['comparison']} music, and includes a plausible hypothesis",
            "The discussion of AI and creativity shows a nuanced understanding of the potential and limitations of AI in music composition",
            "The proposed future directions are innovative and promising for advancing the field",
            "The response adheres to the specified word count and formatting guidelines"
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
