import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        societal_problems = [
            {"problem": "Climate change mitigation", "cognitive_bias": "Present bias"},
            {"problem": "Misinformation spread", "cognitive_bias": "Confirmation bias"},
            {"problem": "Wealth inequality", "cognitive_bias": "Just-world fallacy"},
            {"problem": "Public health crises", "cognitive_bias": "Optimism bias"},
            {"problem": "Urban planning challenges", "cognitive_bias": "Status quo bias"}
        ]
        return {str(i+1): problem for i, problem in enumerate(random.sample(societal_problems, 2))}

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system that simulates and optimizes collective intelligence in human-AI collaborative networks to address the societal problem of {t['problem']}, while considering the impact of {t['cognitive_bias']}. Your response should include:

1. Collective Intelligence Framework (250-300 words):
   a) Define the key components of your collective intelligence system, including human and AI agents.
   b) Explain how your system models and leverages diverse cognitive abilities and knowledge bases.
   c) Describe the mechanisms for information sharing, decision-making, and problem-solving within the network.
   d) Discuss how your system addresses or mitigates the specified cognitive bias.

2. AI System Architecture (250-300 words):
   a) Outline the core components of your AI system, including data processing, modeling, and interface modules.
   b) Explain how your AI system facilitates and enhances human-AI collaboration.
   c) Describe the algorithms or techniques used to optimize collective performance.
   d) Discuss how your system adapts to changing conditions and new information.
   e) Provide a high-level pseudocode or flowchart description (about 10-15 lines) illustrating the main logic of your system.

3. Problem-Solving Approach (200-250 words):
   a) Detail how your collective intelligence system would approach solving the specified societal problem.
   b) Explain how human and AI agents would interact to generate and evaluate potential solutions.
   c) Describe a specific scenario demonstrating your system's problem-solving process.

4. Performance Evaluation (200-250 words):
   a) Propose metrics to evaluate the effectiveness of your collective intelligence system.
   b) Describe methods for measuring the quality and impact of solutions generated by the system.
   c) Discuss how you would compare your system's performance to traditional problem-solving approaches.

5. Ethical Considerations (150-200 words):
   a) Identify potential ethical issues related to human-AI collaborative networks and collective intelligence systems.
   b) Discuss how your system addresses concerns about privacy, autonomy, and accountability.
   c) Propose guidelines for the responsible development and use of collective intelligence technologies.

6. Future Directions (150-200 words):
   a) Suggest two potential improvements or extensions to your collective intelligence system.
   b) Propose a research question that could further the development of human-AI collaborative problem-solving.
   c) Discuss the potential long-term societal impacts of advanced collective intelligence systems.

Ensure your response demonstrates a deep understanding of cognitive science, artificial intelligence, and social dynamics. Be innovative in your approach while maintaining scientific plausibility. Use appropriate terminology and provide clear explanations for complex concepts.

Format your response with clear headings for each section. Your total response should be between 1200-1500 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The response must demonstrate a clear understanding of collective intelligence and how it can be applied to address {t['problem']}.",
            f"The system design should effectively incorporate both human and AI agents, and address the impact of {t['cognitive_bias']}.",
            "The AI system architecture should be well-explained, innovative, and technically sound, integrating principles from cognitive science and artificial intelligence.",
            "The response should include a clear and logical pseudocode or flowchart description of the system's main logic.",
            "The response should thoughtfully address ethical considerations and future implications of collective intelligence systems.",
            "The proposed evaluation metrics and methods should be appropriate and well-reasoned."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
