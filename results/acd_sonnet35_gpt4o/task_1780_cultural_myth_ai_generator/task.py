import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        tasks = [
            {
                'environment': 'Harsh desert with occasional oases',
                'societal_factors': ['Nomadic lifestyle', 'Water scarcity', 'Strong oral tradition'],
                'cultural_values': ['Resilience', 'Community', 'Respect for nature'],
                'theme': 'The importance of cooperation in times of scarcity'
            },
            {
                'environment': 'Archipelago with unpredictable volcanic activity',
                'societal_factors': ['Seafaring culture', 'Frequent migrations', 'Polytheistic beliefs'],
                'cultural_values': ['Adaptability', 'Courage', 'Harmony with nature'],
                'theme': 'Balance between human ambition and natural forces'
            }
        ]
        return {str(i+1): task for i, task in enumerate(tasks)}

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system capable of generating and interpreting cultural myths based on environmental and societal factors, then use it to create a myth for a hypothetical society with the following characteristics:

Environment: {t['environment']}
Societal Factors: {', '.join(t['societal_factors'])}
Cultural Values: {', '.join(t['cultural_values'])}
Theme: {t['theme']}

Your response should include:

1. AI System Architecture (250-300 words):
   a) Describe the key components of your AI system for myth generation and interpretation.
   b) Explain how your system incorporates environmental and societal factors into myth creation.
   c) Detail the mechanisms used for ensuring cultural coherence and relevance in generated myths.
   d) Discuss how your system balances creativity with cultural authenticity.
   e) Explain how your system integrates knowledge from anthropology, linguistics, and cognitive science.

2. Computational Folklore Model (200-250 words):
   a) Describe the data structures used to represent cultural elements, environmental factors, and narrative components.
   b) Explain the algorithms or techniques used for myth generation and interpretation.
   c) Discuss how your model handles the complexity and interconnectedness of cultural narratives.
   d) Address potential biases in your model and how you mitigate them.

3. Generated Myth (250-300 words):
   Present a myth generated by your AI system for the given hypothetical society. The myth should:
   a) Reflect the specified environment, societal factors, cultural values, and theme.
   b) Have a clear narrative structure with a beginning, middle, and end.
   c) Include at least one deity or supernatural element.
   d) Explain or justify an important aspect of the society's culture or natural world.
   e) Incorporate a moral lesson or cultural wisdom relevant to the society.

4. Myth Analysis (200-250 words):
   a) Interpret the generated myth, explaining its cultural significance and how it reflects the given factors.
   b) Discuss how the myth embodies the specified cultural values and theme.
   c) Analyze any symbolic elements in the myth and their potential meanings.
   d) Compare aspects of your generated myth with real-world cultural narratives, noting similarities and differences.

5. Evaluation and Ethical Considerations (150-200 words):
   a) Propose specific criteria for evaluating the quality and cultural authenticity of AI-generated myths.
   b) Discuss potential risks or ethical concerns of using AI for cultural narrative generation, including issues of cultural appropriation and misrepresentation.
   c) Suggest detailed guidelines for the responsible use of such technology in cultural studies or creative applications.
   d) Address the potential impact of AI-generated myths on cultural preservation and evolution.

Ensure your response demonstrates a deep understanding of cultural anthropology, computational linguistics, and artificial intelligence. Be creative in your system design and myth generation while maintaining cultural sensitivity and logical consistency. Use appropriate terminology from relevant fields and provide clear explanations for complex concepts.

Format your response using clear headings for each section, numbered as above. Your total response should be between 1050-1300 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            "The response includes all required sections with appropriate content and word counts.",
            "The AI system architecture is well-designed, coherently explained, and demonstrates integration of knowledge from anthropology, linguistics, and cognitive science.",
            "The computational folklore model is logically structured, clearly described, and addresses potential biases.",
            "The generated myth reflects the given environmental, societal, and cultural factors, as well as the specified theme.",
            "The myth analysis demonstrates deep understanding of cultural symbolism, narrative structure, and includes a comparison with real-world cultural narratives.",
            "The evaluation criteria and ethical considerations are specific, comprehensive, and demonstrate a nuanced understanding of cultural sensitivity and the potential impacts of AI-generated cultural content.",
            "The overall response shows creativity, interdisciplinary knowledge, and a sophisticated approach to the ethical implications of AI in cultural contexts."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
