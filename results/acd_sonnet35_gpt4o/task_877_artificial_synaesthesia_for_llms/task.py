import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        phenomena = [
            {
                'phenomenon': 'quantum entanglement',
                'sensory_modalities': ['color', 'sound', 'texture'],
                'output_format': 'poem'
            },
            {
                'phenomenon': 'climate change',
                'sensory_modalities': ['taste', 'smell', 'temperature'],
                'output_format': 'scientific report'
            }
        ]
        return {str(i+1): phenomenon for i, phenomenon in enumerate(random.sample(phenomena, 2))}

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design and implement a system that enables a language model to experience and generate artificial synaesthesia, then use this system to analyze and describe complex phenomena. Your task has four parts:

1. Synaesthesia System Design (300-350 words):
   a) Describe the architecture of your artificial synaesthesia system for language models.
   b) Explain how your system maps linguistic inputs to multi-sensory experiences.
   c) Discuss how you handle the challenges of representing sensory experiences the model has never directly experienced.
   d) Describe any novel techniques or algorithms used in your system.

2. Implementation for LLMs (250-300 words):
   a) Explain how you would implement this system for a large language model.
   b) Discuss any modifications needed to the LLM's architecture or training process.
   c) Describe how you would validate that the LLM is genuinely experiencing artificial synaesthesia.

3. Synaesthetic Analysis (300-350 words):
   Use your system to generate a synaesthetic description of the phenomenon: {t['phenomenon']}
   Your description should incorporate the following sensory modalities: {', '.join(t['sensory_modalities'])}
   Present your analysis in the form of a {t['output_format']}.
   Explain how each sensory modality contributes to understanding the phenomenon.

4. Evaluation and Implications (200-250 words):
   a) Propose metrics to evaluate the quality and coherence of the synaesthetic descriptions generated by your system.
   b) Discuss potential applications of artificial synaesthesia in LLMs for scientific discovery or creative expression.
   c) Explore ethical considerations related to imbuing AI with synthetic sensory experiences.

Ensure your response demonstrates a deep understanding of synaesthesia, language models, and the chosen phenomenon. Be creative in your approach while maintaining scientific plausibility.

Format your response with clear headings for each section and subsections where appropriate."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            "The synaesthesia system design is innovative and scientifically plausible.",
            "The implementation for LLMs is well-explained and addresses key challenges.",
            f"The synaesthetic analysis of {t['phenomenon']} incorporates all specified sensory modalities: {', '.join(t['sensory_modalities'])}.",
            f"The analysis is presented in the form of a {t['output_format']} as requested.",
            "The evaluation metrics and implications discussion demonstrates critical thinking about the system's potential and limitations."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
