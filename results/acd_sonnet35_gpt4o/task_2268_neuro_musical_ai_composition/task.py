import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        emotional_states = [
            {"state": "Joy", "brain_region": "Nucleus accumbens"},
            {"state": "Fear", "brain_region": "Amygdala"},
            {"state": "Sadness", "brain_region": "Anterior cingulate cortex"},
            {"state": "Anger", "brain_region": "Orbitofrontal cortex"}
        ]
        return {str(i+1): state for i, state in enumerate(random.sample(emotional_states, 2))}

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system that composes music based on neural patterns and emotional states, then analyze its output in terms of music theory and neuroscience. Focus on the emotional state of {t['state']} and its associated brain region, the {t['brain_region']}. Your response should include the following sections:

1. System Architecture (250-300 words):
   a) Describe the key components of your AI system for composing music based on neural patterns and emotional states.
   b) Explain how your system integrates neuroscientific data, particularly from the {t['brain_region']}, with music composition algorithms.
   c) Detail any novel approaches or techniques you've incorporated to map neural activity to musical elements.

2. Neural-Musical Mapping (200-250 words):
   a) Explain how specific neural patterns in the {t['brain_region']} are translated into musical elements (e.g., rhythm, melody, harmony).
   b) Describe how your system captures and represents the emotional state of {t['state']} in its musical output.
   c) Discuss any challenges in this mapping process and how you've addressed them.

3. Music Theory Analysis (200-250 words):
   a) Analyze the expected musical characteristics of compositions generated for the emotional state of {t['state']}.
   b) Discuss how these characteristics align with traditional music theory concepts.
   c) Propose a novel music theory framework that incorporates neural-based composition principles.

4. Neuroscientific Implications (200-250 words):
   a) Discuss how the compositions generated by your system might provide insights into the functioning of the {t['brain_region']}.
   b) Explore potential applications of your system in neuroscience research or therapy.
   c) Propose an experiment to validate the neuroscientific basis of your system's outputs.

5. Ethical Considerations and Limitations (150-200 words):
   a) Discuss potential ethical issues related to using AI for emotion-based music composition.
   b) Address limitations of your approach and propose future research directions.
   c) Consider the broader implications of this technology for our understanding of creativity and emotional expression.

6. Interdisciplinary Impact (150-200 words):
   a) Explain how your system integrates concepts from neuroscience, music theory, and artificial intelligence.
   b) Discuss potential impacts of this technology on music education, therapy, and the creative arts.
   c) Suggest two other scientific or artistic fields that might benefit from or contribute to the development of this system.

Ensure your response demonstrates a deep understanding of neuroscience, music theory, and artificial intelligence. Use appropriate technical terminology and provide clear explanations for complex concepts. Be innovative in your approach while maintaining scientific plausibility.

Format your response with clear headings for each section. Your total response should be between 1150-1450 words. Include a word count at the end of your response.

Remember to use technical terminology appropriately throughout your response, demonstrating your expertise in neuroscience, music theory, and AI."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The response demonstrates a deep understanding of the {t['brain_region']} and its role in the emotional state of {t['state']}.",
            "The proposed AI system integrates neuroscientific principles with music composition in a novel and plausible manner.",
            "The music theory analysis is insightful and proposes a novel framework incorporating neural-based composition principles.",
            "The discussion of neuroscientific implications and potential experiments is well-reasoned and scientifically sound.",
            "The response addresses ethical considerations and limitations thoughtfully.",
            "The interdisciplinary impact is explored comprehensively, demonstrating a broad understanding of potential applications and related fields.",
            "The response effectively integrates concepts from neuroscience, music theory, and AI throughout all sections.",
            "Appropriate technical terminology is used consistently and accurately across all disciplines discussed."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
