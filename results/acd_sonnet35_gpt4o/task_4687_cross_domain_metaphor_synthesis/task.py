import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        scientific_concepts = [
            'quantum entanglement',
            'neural plasticity',
            'genetic drift',
            'dark energy'
        ]
        cultural_contexts = [
            'Japanese',
            'Maasai',
            'Arctic Inuit',
            'Amazonian Yanomami'
        ]
        tasks = {
            "1": {
                "concept": random.choice(scientific_concepts),
                "culture": random.choice(cultural_contexts)
            },
            "2": {
                "concept": random.choice(scientific_concepts),
                "culture": random.choice(cultural_contexts)
            }
        }
        return tasks

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system that generates and analyzes cross-domain metaphors, then apply it to create metaphors bridging the abstract scientific concept of {t['concept']} with everyday experiences in {t['culture']} culture. Your response should include the following sections:

1. Metaphor Generation System Design (300-350 words):
   a) Describe the architecture of your AI system for generating cross-domain metaphors.
   b) Explain how your system integrates knowledge from cognitive linguistics, the target scientific domain, and cultural anthropology.
   c) Detail the process by which your system creates metaphors, including any novel algorithms or techniques.
   d) Discuss how your system ensures cultural sensitivity and relevance in metaphor generation.

2. Conceptual Analysis (200-250 words):
   a) Analyze the key components and characteristics of {t['concept']}.
   b) Identify potential everyday experiences or cultural elements from {t['culture']} that could serve as source domains for metaphors.
   c) Explain how your system would map the abstract concept to concrete experiences.

3. Metaphor Generation and Explanation (250-300 words):
   a) Present three distinct metaphors generated by your system that explain {t['concept']} using elements from {t['culture']}.
   b) For each metaphor, provide:
      - The metaphor itself (1-2 sentences)
      - An explanation of how it relates to the scientific concept (2-3 sentences)
      - An analysis of its cultural relevance and potential impact (2-3 sentences)

4. Cross-cultural Communication Assessment (200-250 words):
   a) Discuss how your generated metaphors might be perceived by both scientists and members of the {t['culture']} community.
   b) Analyze potential challenges in using these metaphors for science communication across cultures.
   c) Propose methods to evaluate the effectiveness of these metaphors in enhancing understanding of {t['concept']}.

5. Ethical Considerations and Limitations (150-200 words):
   a) Identify potential ethical issues in using AI-generated metaphors for cross-cultural science communication.
   b) Discuss limitations of your approach and areas needing further research or refinement.
   c) Propose guidelines for responsible development and application of AI-generated metaphors in educational and communication contexts.

6. Future Directions and Implications (150-200 words):
   a) Suggest two potential extensions or applications of your metaphor generation system.
   b) Discuss how this approach might impact science communication, education, or cross-cultural understanding.
   c) Propose a research question that could further the development of AI-driven metaphor generation and analysis.

Ensure your response demonstrates a deep understanding of cognitive linguistics, the specified scientific concept, and the cultural context. Be creative and innovative in your metaphor generation while maintaining scientific accuracy and cultural sensitivity. Use appropriate terminology from all relevant fields.

Format your response with clear headings for each section. Your total response should be between 1250-1550 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The response includes all required sections with appropriate word counts, totaling between 1250-1550 words.",
            f"The metaphor generation system design is innovative, well-explained, and integrates knowledge from cognitive linguistics, {t['concept']}, and {t['culture']} culture.",
            f"The conceptual analysis demonstrates a thorough understanding of both {t['concept']} and relevant aspects of {t['culture']} culture.",
            f"Three distinct, creative, and culturally relevant metaphors are presented and explained, effectively bridging {t['concept']} with everyday experiences in {t['culture']} culture.",
            "The cross-cultural communication assessment shows critical thinking about the challenges and potential impacts of using these metaphors.",
            "Ethical considerations and limitations are thoughtfully discussed, with specific guidelines proposed for responsible use of AI-generated metaphors.",
            "The future directions and implications section presents innovative ideas and a relevant research question for further development.",
            "The overall response demonstrates interdisciplinary knowledge integration, creative problem-solving, and maintains scientific accuracy and cultural sensitivity throughout."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
