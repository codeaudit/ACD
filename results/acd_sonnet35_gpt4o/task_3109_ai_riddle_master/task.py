import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        riddle_themes = [
            "time",
            "language",
            "paradoxes",
            "emotions",
            "abstract concepts"
        ]
        cognitive_processes = [
            "analogical reasoning",
            "conceptual blending",
            "metaphorical thinking",
            "perspective-taking",
            "counterfactual reasoning"
        ]
        tasks = [
            {
                "riddle_theme": theme,
                "cognitive_process": process
            }
            for theme, process in zip(random.sample(riddle_themes, 2), random.sample(cognitive_processes, 2))
        ]
        return {str(i+1): task for i, task in enumerate(tasks)}

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system capable of generating and solving complex riddles, focusing on the theme of {t['riddle_theme']} and utilizing the cognitive process of {t['cognitive_process']}. Your response should include:

1. System Architecture (300-350 words):
   a) Describe the key components of your AI riddle master system.
   b) Explain how your system incorporates {t['cognitive_process']} in riddle generation and solving.
   c) Detail the natural language processing techniques used to understand and generate riddles.
   d) Discuss how your system integrates cultural knowledge and context awareness.
   e) Include a diagram or flowchart of your system architecture (described in words).

2. Riddle Generation Process (250-300 words):
   a) Explain the step-by-step process your AI system uses to generate riddles on the theme of {t['riddle_theme']}.
   b) Describe how your system ensures the riddles are challenging yet solvable.
   c) Provide an example of a riddle generated by your system, along with its solution.
   d) Analyze how the generated riddle demonstrates {t['cognitive_process']}.

3. Riddle Solving Approach (250-300 words):
   a) Detail the algorithms or techniques your system employs to solve riddles.
   b) Explain how your system handles ambiguity and multiple interpretations in riddles.
   c) Describe how {t['cognitive_process']} is applied in the riddle-solving process.
   d) Provide an example of your system solving a complex riddle, explaining each step.

4. Evaluation and Learning (200-250 words):
   a) Propose methods to evaluate the quality and difficulty of generated riddles.
   b) Describe how your system could learn and improve its riddle generation and solving capabilities over time.
   c) Discuss potential challenges in evaluating the creativity and effectiveness of your AI riddle master.

5. Cognitive Science Insights (200-250 words):
   a) Explain how your AI system's approach to riddle generation and solving relates to human cognitive processes.
   b) Discuss any insights your system might provide into human creativity and problem-solving.
   c) Describe how studying your AI system could contribute to our understanding of {t['cognitive_process']} in human cognition.

6. Ethical Considerations and Future Directions (150-200 words):
   a) Address potential ethical concerns related to AI systems that can generate and solve complex linguistic puzzles.
   b) Discuss possible applications of your AI riddle master in education, entertainment, or cognitive research.
   c) Suggest future improvements or extensions to your system.

Ensure your response demonstrates a deep understanding of artificial intelligence, cognitive science, and linguistics. Use appropriate technical terminology and provide clear explanations for complex concepts. Be innovative in your approach while maintaining scientific plausibility.

Format your response with clear headings for each section. Your total response should be between 1350-1650 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            "The response demonstrates a deep understanding of AI, cognitive science, and linguistics",
            "The proposed AI system is innovative and well-designed for both generating and solving riddles",
            "The system effectively incorporates the specified cognitive process and riddle theme",
            "The riddle generation and solving processes are clearly explained and scientifically plausible",
            "The response includes relevant examples of generated and solved riddles",
            "The evaluation methods and cognitive science insights are well-reasoned and insightful",
            "Ethical considerations and future directions are thoughtfully addressed",
            "The response is well-organized and adheres to the specified word counts for each section"
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
