import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        regions = [
            {
                'region': 'Coastal megacity',
                'primary_challenge': 'Sea level rise and extreme weather events',
                'economic_focus': 'Technology and finance'
            },
            {
                'region': 'Agricultural heartland',
                'primary_challenge': 'Changing precipitation patterns and temperature increase',
                'economic_focus': 'Farming and food production'
            },
            {
                'region': 'Arctic community',
                'primary_challenge': 'Melting permafrost and ecosystem shifts',
                'economic_focus': 'Natural resource extraction and tourism'
            }
        ]
        return {str(i+1): task for i, task in enumerate(random.sample(regions, 2))}

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system that simulates and optimizes climate change mitigation and adaptation strategies, then use it to develop policy recommendations for a {t['region']}. The primary climate challenge for this region is {t['primary_challenge']}, and its economic focus is {t['economic_focus']}. Your response should include the following sections:

1. AI System Architecture (300-350 words):
   a) Describe the overall structure and key components of your AI system.
   b) Explain how your system models climate change impacts, mitigation strategies, and adaptation measures.
   c) Detail how the AI incorporates regional specifics, including the primary challenge and economic focus.
   d) Discuss any novel features or algorithms used in your system.

2. Data Integration and Processing (250-300 words):
   a) Identify the types of data your AI system would require (e.g., climate models, economic data, population statistics).
   b) Explain how your system would integrate and process diverse data sources.
   c) Describe any data challenges specific to the given region and how you'd address them.
   d) Discuss how your system ensures data quality and handles uncertainties.

3. Simulation and Optimization (250-300 words):
   a) Explain how your AI simulates the effects of different climate policies and adaptation strategies.
   b) Describe the optimization algorithms used to identify effective combinations of strategies.
   c) Discuss how your system balances short-term and long-term outcomes.
   d) Explain how the system accounts for potential unintended consequences of proposed strategies.

4. Policy Recommendations (300-350 words):
   a) Provide at least three specific policy recommendations generated by your AI for the given region.
   b) Explain the rationale behind each recommendation, linking to the region's challenges and economic focus.
   c) Discuss potential implementation challenges for each recommendation.
   d) Describe how your AI system evaluates the potential effectiveness of these policies.

5. Ethical Considerations and Stakeholder Engagement (200-250 words):
   a) Identify potential ethical issues in using AI for climate policy development.
   b) Explain how your system incorporates stakeholder input and addresses equity concerns.
   c) Discuss how to ensure transparency and accountability in the AI's decision-making process.
   d) Propose guidelines for the responsible use of AI in climate policy.

6. System Limitations and Future Improvements (200-250 words):
   a) Acknowledge key limitations of your current AI system.
   b) Suggest potential improvements or extensions to address these limitations.
   c) Discuss how the system could be adapted for different regions or scales (e.g., global, national, local).
   d) Propose a method for validating and refining the AI's recommendations over time.

Ensure your response demonstrates a deep understanding of climate science, artificial intelligence, and policy analysis. Use technical terminology appropriately and provide clear explanations for complex concepts. Be innovative in your approach while maintaining scientific and practical plausibility.

Format your response with clear headings for each section. Your total response should be between 1500-1800 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            "The response demonstrates a deep understanding of climate science, artificial intelligence, and policy analysis.",
            "The AI system design effectively incorporates the specified region, primary challenge, and economic focus.",
            "The data integration and processing approach is comprehensive and addresses region-specific challenges.",
            "The simulation and optimization methods are well-explained and scientifically sound.",
            "The policy recommendations are specific, well-reasoned, and relevant to the given region.",
            "Ethical considerations and stakeholder engagement are thoughtfully addressed.",
            "System limitations are acknowledged, and future improvements are proposed.",
            "The response uses technical terminology appropriately and provides clear explanations for complex concepts.",
            "The overall response demonstrates strong interdisciplinary knowledge integration, creative problem-solving, and analytical thinking."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
