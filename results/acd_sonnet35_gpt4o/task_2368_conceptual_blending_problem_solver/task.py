import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        problems = [
            {
                "domain": "Urban Planning",
                "problem": "Traffic congestion in major cities",
                "concept1": "Swarm intelligence",
                "concept2": "Time dilation"
            },
            {
                "domain": "Healthcare",
                "problem": "Adherence to long-term medication regimens",
                "concept1": "Gamification",
                "concept2": "Symbiotic relationships"
            },
            {
                "domain": "Education",
                "problem": "Engaging students in online learning environments",
                "concept1": "Virtual reality",
                "concept2": "Collective consciousness"
            },
            {
                "domain": "Environmental Conservation",
                "problem": "Reducing plastic waste in oceans",
                "concept1": "Biomimicry",
                "concept2": "Quantum entanglement"
            }
        ]
        return {str(i+1): problem for i, problem in enumerate(random.sample(problems, 2))}

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system that uses conceptual blending to generate novel ideas and apply them to solve real-world problems, then analyze its performance and implications. Focus on the problem of {t['problem']} in the domain of {t['domain']}, using the concepts of {t['concept1']} and {t['concept2']} as input for the conceptual blending process.

Your response should include the following sections:

1. Conceptual Blending System Design (300-350 words):
   a) Describe the architecture of your AI system, explaining how it implements conceptual blending.
   b) Detail how your system integrates {t['concept1']} and {t['concept2']} to generate novel concepts.
   c) Explain how the system evaluates and selects the most promising blended concepts.
   d) Discuss any novel approaches or techniques you've incorporated in your design.

2. Problem-Solving Application (250-300 words):
   a) Describe how your system applies the blended concepts to address {t['problem']} in {t['domain']}.
   b) Provide at least two specific, innovative solutions generated by your system.
   c) Explain how these solutions leverage the blended concepts in novel ways.

3. Performance Analysis (200-250 words):
   a) Propose metrics to evaluate the creativity and effectiveness of your system's solutions.
   b) Analyze potential strengths and limitations of your approach compared to traditional problem-solving methods.
   c) Discuss how the specific concepts ({t['concept1']} and {t['concept2']}) influenced the system's performance.

4. Cognitive Science Implications (200-250 words):
   a) Discuss how your system's approach relates to human cognitive processes in creative problem-solving.
   b) Analyze potential insights your system might provide into the nature of human creativity and innovation.
   c) Propose an experiment to compare your system's conceptual blending process with human performance.

5. Ethical and Societal Considerations (150-200 words):
   a) Discuss potential ethical implications of using AI systems for creative problem-solving in {t['domain']}.
   b) Analyze possible societal impacts of implementing your system's solutions for {t['problem']}.
   c) Propose guidelines for responsible development and use of conceptual blending AI systems.

6. Future Research Directions (100-150 words):
   a) Suggest two potential extensions or improvements to your system.
   b) Discuss how these extensions could enhance its capabilities or address limitations.

Ensure your response demonstrates a deep understanding of conceptual blending theory, artificial intelligence, and the specific domain of {t['domain']}. Use technical terminology appropriately and provide clear explanations where necessary. Be creative and innovative in your approach while maintaining scientific plausibility.

Format your response with clear headings for each section. Your total response should be between 1200-1500 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            "The response demonstrates a deep understanding of conceptual blending theory and its application in AI systems",
            "The system design effectively integrates the given concepts and applies them to the specified problem",
            "The proposed solutions are innovative and clearly leverage the blended concepts",
            "The analysis of the system's performance and implications is thorough and insightful",
            "The response addresses ethical and societal considerations thoughtfully",
            "The overall response is well-structured, coherent, and within the specified word limit"
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
