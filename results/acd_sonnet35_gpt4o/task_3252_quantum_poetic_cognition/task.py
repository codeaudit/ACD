import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        tasks = [
            {
                'quantum_principle': 'Superposition',
                'cognitive_process': 'Divergent thinking',
                'poetic_element': 'Metaphor',
                'emotional_theme': 'Nostalgia',
                'word_constraints': ['mirror', 'echo', 'shadow']
            },
            {
                'quantum_principle': 'Entanglement',
                'cognitive_process': 'Associative memory',
                'poetic_element': 'Rhythm',
                'emotional_theme': 'Anticipation',
                'word_constraints': ['pulse', 'dance', 'horizon']
            }
        ]
        return {str(i+1): task for i, task in enumerate(tasks)}

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design a quantum-inspired system for generating and analyzing poetry, incorporating the quantum principle of {t['quantum_principle']}, the cognitive process of {t['cognitive_process']}, and focusing on the poetic element of {t['poetic_element']}. The system should be capable of generating poetry that evokes the emotional theme of {t['emotional_theme']}. Your response should include:

1. Quantum-Cognitive Framework (250-300 words):
   a) Describe the key components of your quantum-inspired poetry system.
   b) Explain how it incorporates the specified quantum principle and cognitive process.
   c) Discuss how these elements contribute to the generation and analysis of poetry.

2. Poetic Generation Mechanism (200-250 words):
   a) Detail the process by which your system generates poetry.
   b) Explain how it incorporates the specified poetic element.
   c) Describe how the system evokes the given emotional theme in its output.
   d) Explain how your system would incorporate the following word constraints: {', '.join(t['word_constraints'])}.

3. Quantum-Linguistic Analysis (200-250 words):
   a) Explain how your system analyzes the generated poetry.
   b) Discuss how quantum principles enhance this analysis compared to classical approaches.
   c) Describe a novel metric or method your system uses to evaluate poetic quality or emotional resonance.

4. Sample Output and Analysis (250-300 words):
   a) Provide a sample poem generated by your system (exactly 6 lines).
   b) Ensure the poem incorporates all the given word constraints.
   c) Analyze the poem, highlighting how it reflects the specified quantum principle, cognitive process, poetic element, and emotional theme.
   d) Discuss any emergent properties or unexpected features in the generated poem.

5. Theoretical Implications (150-200 words):
   a) Discuss how your system might contribute to our understanding of creativity and consciousness.
   b) Explore potential implications for the fields of quantum cognition and computational creativity.

6. Ethical Considerations and Limitations (150-200 words):
   a) Identify potential ethical concerns related to AI-generated art and emotional manipulation.
   b) Discuss limitations of your approach and areas where human expertise would still be necessary.
   c) Propose guidelines for the responsible development and use of quantum-inspired creative AI systems.

Ensure your response demonstrates a deep understanding of quantum mechanics, cognitive science, and poetics. Be innovative in your approach while maintaining scientific plausibility. Use appropriate terminology from relevant fields and provide clear explanations for complex concepts.

Format your response using clear headings for each section, numbered as above. Your total response should be between 1200-1500 words. Responses that do not adhere to these guidelines, including the specific poem format and word constraints, will be scored lower."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            "The response includes all required sections with appropriate content and word counts.",
            "The quantum-cognitive framework is well-designed and coherently explained, demonstrating a deep understanding of both quantum principles and cognitive processes.",
            "The poetic generation mechanism is clearly described and effectively incorporates the specified poetic element, emotional theme, and word constraints.",
            "The quantum-linguistic analysis approach is innovative and well-explained, showcasing how quantum principles enhance poetry analysis.",
            "The sample output is exactly 6 lines, incorporates all given word constraints, and aligns with the specified parameters. The analysis is insightful and comprehensive.",
            "The discussion of theoretical implications is thought-provoking and well-reasoned.",
            "Ethical considerations and limitations are addressed thoughtfully, with practical guidelines proposed.",
            "The overall response demonstrates creativity, interdisciplinary knowledge integration, and a sophisticated approach to the intersection of quantum mechanics, cognitive science, and poetics."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
