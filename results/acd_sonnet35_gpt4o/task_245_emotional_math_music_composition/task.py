import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        emotions = ['joy', 'sadness', 'anger', 'fear', 'surprise', 'disgust']
        math_concepts = ['fractals', 'golden ratio', 'Fibonacci sequence', 'wave interference', 'complex numbers', 'Fourier transform']
        tasks = {
            "1": {
                "emotion": random.choice(emotions),
                "math_concept": random.choice(math_concepts)
            },
            "2": {
                "emotion": random.choice(emotions),
                "math_concept": random.choice(math_concepts)
            }
        }
        return tasks

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Create a system that translates the emotional state of {t['emotion']} into a musical composition using the mathematical concept of {t['math_concept']}. Your task has four parts:

1. Emotional-Mathematical Mapping (150-200 words):
   a) Describe how you would represent the emotional state of {t['emotion']} using mathematical parameters or variables.
   b) Explain how the concept of {t['math_concept']} can be applied to model or generate musical elements (e.g., rhythm, melody, harmony).
   c) Provide at least one mathematical formula or equation that demonstrates this mapping.

2. Musical Translation System (200-250 words):
   a) Design a system that uses your emotional-mathematical mapping to generate a musical composition.
   b) Explain how your system translates mathematical output into specific musical elements (e.g., note selection, chord progressions, tempo changes).
   c) Describe how your system ensures that the resulting composition effectively conveys the intended emotion.

3. Sample Composition (100-150 words):
   a) Provide a brief description of a short musical piece (30 seconds to 1 minute) generated by your system.
   b) Explain how specific elements of the composition reflect both the emotional state and the mathematical concept.

4. Psychological and Artistic Analysis (150-200 words):
   a) Discuss how your system's approach aligns with current understanding of music psychology and emotional responses to music.
   b) Analyze the potential artistic merits and limitations of compositions created using your system.
   c) Propose one way that this system could be used in either music therapy or algorithmic composition for media (e.g., film scores, video games).

Ensure your response demonstrates a deep understanding of music theory, emotional psychology, and mathematical concepts. Be creative in your approach while maintaining scientific plausibility. Organize your answer using clear headings for each section."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            "The response includes all required sections: Emotional-Mathematical Mapping, Musical Translation System, Sample Composition, and Psychological and Artistic Analysis.",
            f"The system effectively integrates the emotional state of {t['emotion']} with the mathematical concept of {t['math_concept']}.",
            "At least one mathematical formula or equation is provided to demonstrate the emotional-mathematical mapping.",
            "The musical translation system is clearly explained and logically connects the mathematical output to specific musical elements.",
            "The sample composition description clearly reflects both the emotional state and the mathematical concept.",
            "The psychological and artistic analysis demonstrates understanding of music psychology and proposes a practical application of the system.",
            "The overall response shows creativity, interdisciplinary knowledge integration, and plausible scientific reasoning."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
