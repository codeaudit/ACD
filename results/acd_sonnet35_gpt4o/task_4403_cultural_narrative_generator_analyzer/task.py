import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        cultures = [
            "Ancient Greek",
            "Yoruba",
            "Inuit",
            "Maori",
            "Aztec",
            "Chinese"
        ]
        narrative_elements = [
            "Hero's Journey",
            "Trickster archetype",
            "Creation myth",
            "Afterlife concept",
            "Coming-of-age ritual",
            "Natural disaster narrative"
        ]
        return {
            "1": {
                "culture": random.choice(cultures),
                "narrative_element": random.choice(narrative_elements)
            },
            "2": {
                "culture": random.choice(cultures),
                "narrative_element": random.choice(narrative_elements)
            }
        }

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system that generates and analyzes culturally-specific narratives based on the {t['culture']} culture, focusing on the narrative element of {t['narrative_element']}. Your response should include the following sections:

1. System Architecture (250-300 words):
   a) Describe the key components of your AI system for generating and analyzing culturally-specific narratives.
   b) Explain how your system integrates computational linguistics, literary theory, and cultural anthropology.
   c) Detail the process of narrative generation and analysis, focusing on cultural authenticity.
   d) Propose a novel algorithm for incorporating the specified narrative element into the story structure.

2. Cultural-Narrative Mapping (200-250 words):
   a) Explain the significance of the {t['narrative_element']} in {t['culture']} storytelling traditions.
   b) Describe how your system translates cultural knowledge into narrative features and structures.
   c) Discuss how variations in cultural parameters would result in different narrative outputs.

3. Narrative Generation and Analysis (200-250 words):
   a) Explain the process by which your AI system generates narratives based on the cultural-narrative mapping.
   b) Describe how the system ensures cultural authenticity and narrative coherence.
   c) Detail how the AI analyzes the generated narratives in terms of their cultural significance and literary merit.
   d) Provide a brief example (100-150 words) of a narrative snippet generated by your system, demonstrating its cultural specificity and incorporation of the {t['narrative_element']}.

4. Linguistic and Stylistic Considerations (150-200 words):
   a) Discuss how your system incorporates {t['culture']}-specific linguistic features and literary devices.
   b) Explain how the AI adapts its language model to capture the unique voice and style of {t['culture']} narratives.
   c) Propose a method to evaluate the linguistic and stylistic authenticity of the generated narratives.

5. Applications and Implications (150-200 words):
   a) Suggest potential applications of your cultural narrative AI system in fields such as education, cultural preservation, or creative writing.
   b) Discuss the implications of this technology for cross-cultural understanding and literary studies.
   c) Propose an experiment to test the system's effectiveness in generating culturally authentic and engaging narratives.

6. Ethical Considerations (100-150 words):
   a) Identify potential ethical concerns related to AI-generated cultural narratives.
   b) Discuss the implications of using AI to represent and potentially influence cultural storytelling traditions.
   c) Propose guidelines for the responsible development and use of cultural narrative AI systems.
   d) Briefly explain how your system would address potential cultural biases or misrepresentations.

Ensure your response demonstrates a deep understanding of computational linguistics, literary theory, and cultural anthropology. Use appropriate terminology from all relevant fields and provide clear explanations where necessary. Be creative in your approach while maintaining cultural sensitivity and academic rigor.

Format your response with clear headings for each section. Your total response should be between 1150-1500 words, including the example narrative snippet. Include a word count at the end of your submission."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The response must demonstrate a clear understanding of {t['culture']} culture and the {t['narrative_element']} concept.",
            "The system architecture should logically integrate computational linguistics, literary theory, and cultural anthropology.",
            "The cultural-narrative mapping should show a deep understanding of the specified culture's storytelling traditions.",
            "The narrative generation and analysis process should be well-explained and culturally sensitive.",
            "The example narrative snippet should demonstrate cultural specificity and incorporate the given narrative element.",
            "The linguistic and stylistic considerations should be specific to the given culture and well-justified.",
            "The proposed applications and implications should be innovative and well-reasoned.",
            "The ethical considerations should be thoughtful and comprehensive, including addressing potential cultural biases.",
            "The overall response should be creative, coherent, and demonstrate interdisciplinary thinking.",
            "The response should adhere to the specified word limits for each section and the overall word count."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
