import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        scientific_fields = [
            {
                "field": "Astrophysics",
                "current_challenge": "Dark matter detection",
                "key_concept": "Gravitational lensing"
            },
            {
                "field": "Neuroscience",
                "current_challenge": "Consciousness mapping",
                "key_concept": "Neural correlates of consciousness"
            },
            {
                "field": "Quantum Biology",
                "current_challenge": "Quantum effects in photosynthesis",
                "key_concept": "Quantum coherence"
            },
            {
                "field": "Synthetic Biology",
                "current_challenge": "Designing artificial cells",
                "key_concept": "Minimal genome"
            }
        ]
        return {
            "1": random.choice(scientific_fields),
            "2": random.choice(scientific_fields)
        }

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system that models and enhances human creativity in scientific discovery, then apply it to generate novel hypotheses in the field of {t['field']}. Your system should address the current challenge of {t['current_challenge']} and incorporate the key concept of {t['key_concept']}. Your response should include:

1. Creativity Model Architecture (300-350 words):
   a) Describe the key components of your AI system for modeling scientific creativity.
   b) Explain how your system integrates cognitive models of creativity with AI techniques.
   c) Detail how your system is tailored to enhance creativity in {t['field']}.
   d) Include a high-level diagram or pseudocode to illustrate your architecture (describe it textually).
   e) Explain how your system incorporates the key concept of {t['key_concept']}.

2. Cognitive-AI Integration (250-300 words):
   a) Explain how your AI system models and enhances specific cognitive processes involved in scientific creativity.
   b) Describe any novel algorithms or techniques used in your system to simulate or augment creative thinking.
   c) Discuss how your system balances convergent and divergent thinking in the scientific process.
   d) Provide a concrete example of how this integration would work in practice for {t['field']}.

3. Hypothesis Generation Process (250-300 words):
   a) Provide a step-by-step explanation of how your system would approach generating novel hypotheses.
   b) Describe how your system incorporates existing knowledge in {t['field']} to inform hypothesis generation.
   c) Explain how your system evaluates and refines generated hypotheses.
   d) Address how your system specifically tackles the challenge of {t['current_challenge']}.

4. Novel Hypotheses (200-250 words):
   a) Present 2-3 novel hypotheses generated by your system for the challenge of {t['current_challenge']}.
   b) Explain the reasoning behind each hypothesis and how it builds on the key concept of {t['key_concept']}.
   c) Discuss the potential impact and testability of these hypotheses.

5. Evaluation and Validation (200-250 words):
   a) Propose specific, measurable metrics to evaluate the creativity and scientific validity of your system's outputs.
   b) Describe a detailed methodology for benchmarking your system against human scientists in {t['field']}.
   c) Discuss any potential limitations or biases in your approach and how you would address them.
   d) Suggest a comprehensive experimental design to test one of your generated hypotheses, including control groups and potential confounding variables.

6. Ethical Implications (150-200 words):
   a) Identify at least three potential ethical issues arising from the use of AI in scientific discovery.
   b) Discuss the implications of AI-generated hypotheses on scientific credit, authorship, and the peer review process.
   c) Propose specific guidelines for responsible development and use of creativity-enhancing AI in science.

Ensure your response demonstrates a deep understanding of cognitive science, artificial intelligence, and {t['field']}. Use appropriate technical terminology and provide clear explanations for complex concepts. Be creative and innovative in your approach while maintaining scientific plausibility.

Format your response with clear headings for each section, numbered as above. Use appropriate subheadings within each section. Your total response should be between 1350-1650 words. Include a word count at the end of your response."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The response demonstrates a deep understanding of cognitive science, artificial intelligence, and {t['field']}.",
            "The proposed AI system integrates cognitive models of creativity with AI techniques in a novel and plausible way.",
            f"The system effectively addresses the challenge of {t['current_challenge']} and incorporates the key concept of {t['key_concept']}.",
            "The generated hypotheses are creative, scientifically plausible, and potentially impactful.",
            "The response includes a thoughtful discussion of evaluation methods with specific, measurable metrics.",
            "The ethical implications section addresses at least three distinct issues and proposes specific guidelines.",
            "The overall response is well-structured, coherent, and within the specified word count range."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
