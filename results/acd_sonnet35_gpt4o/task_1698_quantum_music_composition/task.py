import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        quantum_concepts = [
            "Superposition",
            "Entanglement",
            "Quantum Interference",
            "Quantum Tunneling"
        ]
        musical_elements = [
            "Harmony",
            "Rhythm",
            "Melody",
            "Timbre"
        ]
        musical_genres = [
            "Classical",
            "Jazz",
            "Electronic",
            "World Music"
        ]
        musical_techniques = [
            "Polyrhythm",
            "Microtonality",
            "Aleatoric composition",
            "Spectral music"
        ]
        tasks = {}
        for i in range(2):
            tasks[str(i+1)] = {
                "quantum_concept": random.choice(quantum_concepts),
                "musical_element": random.choice(musical_elements),
                "genre": random.choice(musical_genres),
                "time_signature": random.choice(["4/4", "3/4", "5/4", "7/8"]),
                "duration": random.randint(30, 120),
                "musical_technique": random.choice(musical_techniques)
            }
        return tasks

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design a quantum computing-inspired system for music composition that incorporates the quantum concept of {t['quantum_concept']} to generate or manipulate the musical element of {t['musical_element']}. Then, use this system to compose a short piece in the {t['genre']} genre, incorporating the musical technique of {t['musical_technique']}. Your composition should use a {t['time_signature']} time signature and be approximately {t['duration']} seconds long. Your response should include:

1. Quantum-Musical System Design (300-350 words):
   a) Explain how the quantum concept of {t['quantum_concept']} can be applied to generate or manipulate {t['musical_element']}.
   b) Describe the key components and processes of your quantum-inspired music composition system.
   c) Discuss how your system integrates quantum computing principles with music theory.
   d) Explain how your system incorporates the musical technique of {t['musical_technique']} in relation to the quantum concept and musical element.

2. Composition Process (200-250 words):
   a) Describe step-by-step how your system would compose a short piece in the {t['genre']} genre.
   b) Explain how the quantum-inspired approach and the musical technique of {t['musical_technique']} influence the compositional choices.
   c) Discuss any challenges or unique considerations when applying this system to the {t['genre']} genre and the given time signature.

3. Musical Analysis (250-300 words):
   a) Provide a detailed analysis of the hypothetical piece composed by your system.
   b) Explain how specific elements of the composition reflect the quantum concept, musical element, and musical technique.
   c) Discuss how the piece fits within or challenges traditional conventions of the {t['genre']} genre.
   d) Describe any emergent properties or unexpected features in the composition.

4. Comparative Evaluation (150-200 words):
   a) Compare your quantum-inspired composition system to traditional algorithmic composition methods.
   b) Discuss potential advantages and limitations of your approach, particularly in relation to the incorporation of {t['musical_technique']}.
   c) Propose a method for evaluating the creativity and musical quality of compositions generated by your system.

5. Future Applications and Implications (200-250 words):
   a) Suggest two potential extensions or improvements to your quantum-inspired music composition system.
   b) Discuss how this approach might influence music theory, composition practices, or our understanding of creativity.
   c) Propose a research question that bridges your quantum-musical system with another scientific or artistic field.
   d) Speculate on the potential long-term impacts of quantum-inspired creative systems on the arts and sciences.

6. Visual or Auditory Representation (100-150 words):
   Provide a textual description of a visual or auditory representation of your composed piece. This could be a description of musical notation, a graphical score, or a detailed explanation of how the piece would sound if played, emphasizing how it incorporates {t['musical_technique']}.

Ensure your response demonstrates a deep understanding of quantum computing concepts, music theory, and the specific musical technique. Use appropriate terminology from all relevant fields and provide clear explanations for complex ideas. Be creative and innovative in your approach while maintaining scientific and logical consistency.

Format your response with clear headings for each section and number your paragraphs within each section. Your total response should be between 1200-1500 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            "The response demonstrates a deep understanding of quantum computing concepts, music theory, and the specified musical technique",
            f"The system design effectively incorporates the quantum concept of {t['quantum_concept']} with the musical element of {t['musical_element']} and the technique of {t['musical_technique']}",
            f"The composition process and analysis are consistent with the {t['genre']} genre, {t['time_signature']} time signature, and approximately {t['duration']} seconds duration while incorporating quantum-inspired elements and {t['musical_technique']}",
            "The comparative evaluation and future applications sections show innovative thinking and interdisciplinary connections",
            "The response includes a clear and detailed visual or auditory representation of the composed piece, emphasizing the incorporation of the specified musical technique",
            "The response is creative, logically consistent, and demonstrates complex interdisciplinary reasoning",
            "The response follows the specified format with clear headings and numbered paragraphs",
            "The total word count is between 1200-1500 words"
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
