import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        scenarios = [
            {
                "climate_factor": "Urban heat islands",
                "behavioral_focus": "Energy consumption habits"
            },
            {
                "climate_factor": "Deforestation",
                "behavioral_focus": "Consumer choices in wood products"
            },
            {
                "climate_factor": "Agricultural methane emissions",
                "behavioral_focus": "Dietary preferences"
            },
            {
                "climate_factor": "Transportation emissions",
                "behavioral_focus": "Commuting and travel habits"
            }
        ]
        return {str(i+1): task for i, task in enumerate(random.sample(scenarios, 2))}

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system that integrates climate science models with behavioral psychology to create personalized interventions for reducing individual carbon footprints, focusing on the climate factor of {t['climate_factor']} and the behavioral aspect of {t['behavioral_focus']}. Then, analyze its potential impact and ethical implications. Your response should include:

1. System Architecture (300-350 words):
   a) Describe the key components of your AI system, including climate modeling, behavioral analysis, and intervention generation.
   b) Explain how your system integrates data from climate science and behavioral psychology.
   c) Detail the AI techniques or algorithms used for personalization and intervention design.
   d) Discuss how your system adapts to changing climate conditions and individual behaviors over time.

2. Climate-Behavior Integration (250-300 words):
   a) Explain how your system models the relationship between {t['climate_factor']} and {t['behavioral_focus']}.
   b) Describe the data sources and parameters your system uses to assess individual impact on the specified climate factor.
   c) Discuss how your system accounts for variability in individual circumstances and behaviors.

3. Intervention Design (250-300 words):
   a) Detail the process of generating personalized interventions to modify {t['behavioral_focus']}.
   b) Explain how your system tailors interventions based on individual psychological profiles and circumstances.
   c) Provide an example of a potential intervention generated by your system, including its rationale and expected impact.

4. Impact Analysis (200-250 words):
   a) Estimate the potential impact of your system on reducing individual carbon footprints related to {t['climate_factor']}.
   b) Discuss how widespread adoption of your system could affect broader climate trends.
   c) Analyze potential challenges or limitations in achieving the estimated impact.

5. Ethical Implications (200-250 words):
   a) Identify three potential ethical concerns raised by your AI system.
   b) Discuss the balance between individual privacy and the need for detailed behavioral data.
   c) Propose guidelines for the responsible development and deployment of your system.

6. Future Developments (150-200 words):
   a) Suggest two potential enhancements to your system that could increase its effectiveness or scope.
   b) Discuss how your system could be adapted to address other climate factors or behavioral aspects.

Ensure your response demonstrates a deep understanding of climate science, artificial intelligence, and behavioral psychology. Use appropriate technical terminology and provide clear explanations for complex concepts. Be innovative in your approach while maintaining scientific plausibility.

Format your response with clear headings for each section, numbered as above. Your total response should be between 1350-1650 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The response must address the climate factor of {t['climate_factor']} and the behavioral aspect of {t['behavioral_focus']}",
            "The system design should demonstrate integration of climate science, behavioral psychology, and AI techniques",
            "The response should include a detailed analysis of potential impact and ethical implications",
            "The proposed interventions should be innovative, personalized, and scientifically plausible",
            "The response should demonstrate a deep understanding of the interdisciplinary nature of the task"
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
