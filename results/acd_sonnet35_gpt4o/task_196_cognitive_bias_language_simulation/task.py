import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        cognitive_biases = [
            {
                "bias": "Confirmation Bias",
                "description": "The tendency to search for, interpret, favor, and recall information in a way that confirms or supports one's prior beliefs or values.",
                "text": "Recent studies show mixed results on the effectiveness of a new diet plan."
            },
            {
                "bias": "Availability Heuristic",
                "description": "The tendency to overestimate the likelihood of events with greater 'availability' in memory, which can be influenced by how unusual or emotionally charged they may be.",
                "text": "Experts debate the actual risk of shark attacks for beach-goers."
            },
            {
                "bias": "Dunning-Kruger Effect",
                "description": "A cognitive bias in which people with limited knowledge or competence in a given intellectual or social domain greatly overestimate their own knowledge or competence in that domain.",
                "text": "After a one-day workshop, participants were asked to evaluate their expertise in the subject."
            }
        ]
        return {
            "1": random.choice(cognitive_biases),
            "2": random.choice(cognitive_biases)
        }

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"Design a language system that simulates how the cognitive bias of {t['bias']} might affect language processing and generation. Your task has the following parts:\n\n1. Bias Description and Linguistic Features (100-150 words):\n   a) Briefly explain the {t['bias']} and its potential effects on thinking and behavior.\n   b) Describe 3-4 specific linguistic features that might characterize language affected by this bias (e.g., specific word choices, sentence structures, rhetorical devices).\n\n2. Language System Design (200-250 words):\n   a) Create a set of rules for generating or modifying language to reflect the {t['bias']}.\n   b) Explain how your rules capture the essence of the bias and its linguistic manifestations.\n   c) Discuss any limitations or potential issues with your language system.\n\n3. Text Rewriting (100-150 words):\n   Rewrite the following text using your language system to simulate how it might be processed or generated by someone affected by the {t['bias']}:\n   \"{t['text']}\"\n   Explain the changes you made and how they reflect the bias.\n\n4. AI Implications (100-150 words):\n   a) Discuss how an AI language model might exhibit or be affected by this cognitive bias.\n   b) Propose a method to potentially mitigate this bias in AI language processing or generation.\n\n5. Ethical Considerations (100-150 words):\n   Discuss potential ethical implications of simulating cognitive biases in language systems, particularly in the context of AI development and use.\n\nEnsure your response is creative, psychologically grounded, and linguistically plausible. Demonstrate a deep understanding of the interconnections between cognitive science, linguistics, and artificial intelligence throughout your answer. Organize your response using clear headings for each section."

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The response accurately explains the {t['bias']} and its potential effects on language.",
            "The language system design includes specific rules for generating or modifying language to reflect the given cognitive bias.",
            f"The rewritten text demonstrates a plausible application of the {t['bias']} to the original text.",
            "The response discusses potential implications of the cognitive bias for AI language models.",
            "The answer addresses ethical considerations of simulating cognitive biases in language systems.",
            "The response demonstrates creativity and interdisciplinary knowledge application.",
            "The answer is well-organized with clear headings for each required section."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
