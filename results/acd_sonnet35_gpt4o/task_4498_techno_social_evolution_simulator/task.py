import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        scenarios = [
            {
                "tech_domain": "Artificial Intelligence",
                "social_aspect": "Labor Market",
                "time_frame": "20 years"
            },
            {
                "tech_domain": "Biotechnology",
                "social_aspect": "Healthcare Systems",
                "time_frame": "30 years"
            },
            {
                "tech_domain": "Renewable Energy",
                "social_aspect": "Urban Development",
                "time_frame": "25 years"
            },
            {
                "tech_domain": "Virtual Reality",
                "social_aspect": "Education Systems",
                "time_frame": "15 years"
            }
        ]
        return {
            "1": random.choice(scenarios),
            "2": random.choice(scenarios)
        }

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"Design a complex systems simulator that models and predicts societal changes resulting from advancements in {t['tech_domain']}, focusing on the impact on {t['social_aspect']} over the next {t['time_frame']}. Your response should include the following sections:\n\nBrief Example: Consider how the introduction of smartphones impacted communication patterns and social interactions over a 10-year period. Your simulator should be capable of modeling similar complex interactions between technology and society, but for the specified domain and timeframe.\n\n1. Simulator Architecture (300-350 words):\n   a) Describe the key components of your complex systems simulator.\n   b) Explain how your system integrates sociological theories, technology forecasting methods, and machine learning algorithms.\n   c) Detail the data sources and types of data your simulator would use.\n   d) Include a high-level diagram or pseudocode illustrating the simulator's architecture.\n\n2. Technological Advancement Modeling (250-300 words):\n   a) Explain how your simulator models the progression of {t['tech_domain']} over the {t['time_frame']} period.\n   b) Describe the key factors and variables considered in this technological forecasting.\n   c) Discuss how your model accounts for potential disruptive innovations or unexpected developments.\n\n3. Societal Impact Analysis (250-300 words):\n   a) Detail how your simulator analyzes the impact of {t['tech_domain']} advancements on {t['social_aspect']}.\n   b) Explain the sociological theories or frameworks incorporated in your model.\n   c) Describe how your simulator accounts for complex societal interactions and feedback loops.\n\n4. Machine Learning Integration (200-250 words):\n   a) Explain how machine learning is used in your simulator for prediction and pattern recognition.\n   b) Describe the type(s) of machine learning algorithms employed and why they are suitable for this task.\n   c) Discuss how your system handles uncertainty and improves its predictions over time.\n\n5. Simulation Outputs and Visualization (200-250 words):\n   a) Describe the key outputs and predictions generated by your simulator.\n   b) Explain how these outputs are visualized or presented to aid understanding.\n   c) Provide an example of a specific prediction or insight your simulator might generate.\n\n6. Validation and Limitations (150-200 words):\n   a) Propose methods to validate the accuracy and reliability of your simulator.\n   b) Discuss the limitations of your approach and potential sources of bias or error.\n   c) Suggest ways to mitigate these limitations in future iterations.\n\n7. Ethical Considerations and Societal Implications (150-200 words):\n   a) Discuss the ethical implications of using such a simulator for societal prediction and planning.\n   b) Address potential concerns about privacy, data use, and the impact of predictive modeling on policy-making.\n   c) Propose guidelines for the responsible use of your simulator in research and policy contexts.\n\nEnsure your response demonstrates a deep understanding of complex systems theory, sociology, technology forecasting, and machine learning. Use appropriate technical terminology and provide clear explanations for complex concepts. Be innovative in your approach while maintaining scientific plausibility. Balance depth and breadth in your response, providing sufficient detail in each section while covering all required aspects.\n\nFormat your response with clear headings for each section. Your total response should be between 1500-2000 words."

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The response demonstrates a comprehensive understanding of complex systems simulation and its application to modeling societal changes due to technological advancements in {t['tech_domain']}.",
            f"The proposed simulator for predicting the impact of {t['tech_domain']} on {t['social_aspect']} over {t['time_frame']} is scientifically plausible and innovative.",
            f"The response shows strong interdisciplinary integration of sociology, technology forecasting, and machine learning, with clear explanations of how these fields interact in the simulator.",
            f"The analysis considers multiple perspectives on the societal impacts of {t['tech_domain']} advancements, including potential positive and negative outcomes.",
            f"The ethical analysis is thorough, considering various stakeholder perspectives and proposing concrete guidelines for responsible use.",
            "The response includes novel ideas or approaches not explicitly mentioned in the instructions, demonstrating creativity and original thinking.",
            "The writing consistently uses appropriate scientific terminology from relevant fields, with clear explanations of complex concepts.",
            f"The response includes specific technical details related to modeling {t['tech_domain']} advancements and their impact on {t['social_aspect']}, including concrete examples or case studies.",
            "The response is between 1500-2000 words and maintains a balance between depth and breadth across all required sections."
        ]
        
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
