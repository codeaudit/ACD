import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        math_concepts = [
            "Fractal geometry",
            "Prime number sequences",
            "Fibonacci sequence",
            "Topology"
        ]
        cognitive_processes = [
            "Working memory",
            "Pattern recognition",
            "Spatial reasoning",
            "Emotional processing"
        ]
        return {
            "1": {
                "math_concept": random.choice(math_concepts),
                "cognitive_process": random.choice(cognitive_processes)
            },
            "2": {
                "math_concept": random.choice(math_concepts),
                "cognitive_process": random.choice(cognitive_processes)
            }
        }

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design a system that translates the mathematical concept of {t['math_concept']} into musical compositions, then use it to explore how perceiving these mathematical structures through music might affect the cognitive process of {t['cognitive_process']}. Your response should include the following sections:

1. System Design (300-350 words):
   a) Describe the key components of your mathematical music translation system.
   b) Explain how your system converts {t['math_concept']} into musical elements (e.g., rhythm, melody, harmony).
   c) Discuss any novel algorithms or techniques used in your translation process.
   d) Provide an example of how a specific aspect of {t['math_concept']} would be represented musically.

2. Musical Representation (250-300 words):
   a) Describe the musical style or genre that best suits the representation of {t['math_concept']}.
   b) Explain how different properties of {t['math_concept']} are mapped to musical parameters.
   c) Discuss how your system ensures the resulting music is both mathematically accurate and aesthetically pleasing.
   d) Provide a notated example (described textually) of a short musical phrase generated by your system.

3. Cognitive Impact Analysis (250-300 words):
   a) Hypothesize how listening to music generated from {t['math_concept']} might affect {t['cognitive_process']}.
   b) Describe the cognitive mechanisms that might be involved in processing this mathematical music.
   c) Propose an experiment to test the effects of your mathematical music on {t['cognitive_process']}.
   d) Discuss potential applications of your system in cognitive enhancement or therapy.

4. Interdisciplinary Implications (200-250 words):
   a) Explore how your system might contribute to advancements in mathematics education.
   b) Discuss potential applications in data sonification or scientific communication.
   c) Consider how this approach might influence our understanding of the relationship between mathematics, music, and cognition.

5. Ethical Considerations and Limitations (150-200 words):
   a) Discuss any ethical implications of using mathematical music to influence cognitive processes.
   b) Address potential biases or limitations in your system and how they might be mitigated.
   c) Consider the broader societal impacts of widespread use of such technology.

Ensure your response demonstrates a deep understanding of the chosen mathematical concept, music theory, and cognitive science principles. Be creative and innovative in your approach while maintaining scientific plausibility. Use appropriate technical terminology from each field and provide clear explanations where necessary.

Format your response with clear headings for each section. Your total response should be between 1150-1400 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            f"The response includes a detailed and scientifically plausible description of a system that translates {t['math_concept']} into musical compositions.",
            f"The system's potential impact on {t['cognitive_process']} is thoroughly explored and analyzed.",
            "The musical representation is clearly explained, with specific examples of how mathematical properties are mapped to musical elements.",
            "The response demonstrates a strong understanding of the chosen mathematical concept, music theory, and relevant cognitive science principles.",
            "Potential applications, ethical considerations, and limitations of the system are thoughtfully discussed.",
            "The overall response showcases creativity and innovation while maintaining scientific plausibility and logical consistency."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
