import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        disciplines = ['Physics', 'Biology', 'Chemistry', 'Psychology', 'Neuroscience', 'Computer Science']
        task = {
            "primary_discipline": random.choice(disciplines)
        }
        task["secondary_discipline"] = random.choice([d for d in disciplines if d != task["primary_discipline"]])
        return {"1": task, "2": task}

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"Design an AI system capable of generating and evaluating novel scientific hypotheses, then use it to propose a groundbreaking interdisciplinary research project combining {t['primary_discipline']} and {t['secondary_discipline']}. Your response should include the following sections:\n\n" \
               f"1. AI System Architecture (300-350 words):\n" \
               f"   a) Describe the key components of your AI hypothesis generator and evaluator.\n" \
               f"   b) Explain how your system integrates knowledge from various scientific disciplines.\n" \
               f"   c) Detail the algorithms or techniques used for hypothesis generation and evaluation.\n" \
               f"   d) Discuss how your system ensures scientific validity and novelty of the generated hypotheses.\n" \
               f"   e) Include a diagram or flowchart of your system architecture (described in words).\n\n" \
               f"2. Hypothesis Generation Process (250-300 words):\n" \
               f"   a) Explain the step-by-step process your AI system uses to generate hypotheses.\n" \
               f"   b) Describe how your system combines concepts from {t['primary_discipline']} and {t['secondary_discipline']}.\n" \
               f"   c) Discuss how your system identifies potential causal relationships or correlations.\n" \
               f"   d) Provide an example of a hypothesis generated by your system, explaining its interdisciplinary nature.\n\n" \
               f"3. Hypothesis Evaluation Mechanism (250-300 words):\n" \
               f"   a) Detail the criteria your system uses to evaluate the generated hypotheses.\n" \
               f"   b) Explain how your system assesses the novelty, feasibility, and potential impact of each hypothesis.\n" \
               f"   c) Describe any simulation or predictive modeling capabilities used in the evaluation process.\n" \
               f"   d) Discuss how your system handles uncertainty and conflicting evidence.\n\n" \
               f"4. Interdisciplinary Research Proposal (300-350 words):\n" \
               f"   a) Present a groundbreaking research proposal generated by your AI system, combining {t['primary_discipline']} and {t['secondary_discipline']}.\n" \
               f"   b) Explain the hypothesis, its scientific basis, and potential implications.\n" \
               f"   c) Describe the proposed methodology for testing this hypothesis.\n" \
               f"   d) Discuss potential challenges and how they might be addressed.\n" \
               f"   e) Explain how this research could advance both disciplines and potentially create a new field of study.\n\n" \
               f"5. Ethical Considerations and Limitations (200-250 words):\n" \
               f"   a) Discuss potential ethical implications of using AI for scientific hypothesis generation and evaluation.\n" \
               f"   b) Address concerns about bias in the AI system and how they are mitigated.\n" \
               f"   c) Explore the limitations of your AI system and areas for future improvement.\n" \
               f"   d) Consider the broader implications of AI-driven scientific discovery for the scientific community and society.\n\n" \
               f"Ensure your response demonstrates a deep understanding of the scientific method, the chosen disciplines, and artificial intelligence. Use appropriate technical terminology and provide clear explanations for complex concepts. Be innovative in your approach while maintaining scientific plausibility.\n\n" \
               f"Format your response with clear headings for each section. Your total response should be between 1300-1550 words. Include a word count at the end of your response."

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            "The response demonstrates a deep understanding of the scientific method, the chosen disciplines, and artificial intelligence.",
            "The AI system design is innovative, coherent, and plausibly capable of generating and evaluating scientific hypotheses.",
            "The interdisciplinary research proposal is groundbreaking, well-reasoned, and effectively combines the two specified disciplines.",
            "The response addresses ethical considerations and limitations thoughtfully and comprehensively.",
            "The writing is clear, well-structured, and uses appropriate technical terminology.",
            "The response adheres to the specified word count and includes a word count at the end."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
