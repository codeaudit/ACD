import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        scenarios = [
            {
                "source_domain": "fluid dynamics",
                "target_domain": "economic systems",
                "concept_to_explain": "market equilibrium"
            },
            {
                "source_domain": "quantum mechanics",
                "target_domain": "social networks",
                "concept_to_explain": "information propagation"
            },
            {
                "source_domain": "evolutionary biology",
                "target_domain": "artificial intelligence",
                "concept_to_explain": "neural network training"
            },
            {
                "source_domain": "thermodynamics",
                "target_domain": "cognitive psychology",
                "concept_to_explain": "memory consolidation"
            }
        ]
        return {
            "1": random.choice(scenarios),
            "2": random.choice(scenarios)
        }

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design a cognitive architecture-based AI system capable of understanding and generating novel metaphors across different domains of knowledge, then apply it to explain complex scientific concepts. Your task is to create a detailed proposal for this system, focusing on translating concepts from {t['source_domain']} to {t['target_domain']}, and use it to explain the concept of {t['concept_to_explain']}. Address the following points:

1. Cognitive Architecture Design (300-350 words):
   a) Describe the key components of your cognitive architecture for metaphor understanding and generation.
   b) Explain how your system represents and processes knowledge from different domains.
   c) Detail the mechanisms for identifying analogies and generating metaphors.
   d) Discuss how your architecture integrates with or improves upon existing cognitive models (e.g., ACT-R, SOAR).
   e) Include a high-level diagram or pseudocode snippet illustrating a key aspect of your system.

2. Knowledge Representation and Reasoning (250-300 words):
   a) Explain how your system represents knowledge in {t['source_domain']} and {t['target_domain']}.
   b) Describe the reasoning processes used to identify relevant analogies between domains.
   c) Discuss how your system handles uncertainty and ambiguity in metaphor interpretation.
   d) Provide an example of how a specific concept might be represented and processed in your system.

3. Metaphor Generation Process (250-300 words):
   a) Detail the step-by-step process your system uses to generate novel metaphors.
   b) Explain how creativity and novelty are incorporated into the metaphor generation process.
   c) Describe how your system evaluates the quality and appropriateness of generated metaphors.
   d) Discuss any constraints or guidelines used to ensure metaphor coherence and relevance.

4. Application to Scientific Concept Explanation (300-350 words):
   a) Demonstrate how your system would explain {t['concept_to_explain']} using metaphors from {t['source_domain']}.
   b) Provide at least two novel metaphors generated by your system for this concept.
   c) Analyze the strengths and limitations of these metaphors in explaining the scientific concept.
   d) Discuss how your system could adapt its explanations for different audiences (e.g., experts vs. general public).

5. Evaluation and Validation (200-250 words):
   a) Propose methods to evaluate the effectiveness of your system in generating and explaining metaphors.
   b) Describe potential experiments to test your system's performance against human experts.
   c) Discuss how you would measure the system's impact on learning and understanding complex concepts.

6. Ethical Considerations and Societal Impact (150-200 words):
   a) Address potential ethical concerns related to using AI-generated metaphors for explaining scientific concepts.
   b) Discuss the implications of your system for science communication and education.
   c) Propose guidelines for the responsible development and use of metaphor-generating AI systems.

Ensure your response demonstrates a deep understanding of cognitive science, linguistics, artificial intelligence, and the specific scientific domains mentioned. Use appropriate technical terminology and provide clear explanations for complex concepts. Be innovative in your approach while maintaining scientific plausibility.

Format your response with clear headings for each section. Your total response should be between 1450-1750 words. Include a word count at the end of your submission."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            "The response demonstrates a deep understanding of cognitive architectures, metaphor theory, and the specified scientific domains.",
            "The proposed system effectively integrates cognitive science principles with AI techniques for metaphor generation and understanding.",
            "The metaphor generation process is clearly explained and demonstrates creativity and novelty.",
            "The application of the system to explain the given scientific concept is thorough and insightful.",
            "The response addresses ethical considerations and societal impact thoughtfully.",
            "The submission is well-structured, following the specified format and word count guidelines."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
