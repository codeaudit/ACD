import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        scenarios = [
            "Emergency room triage",
            "Mental health counseling",
            "Pediatric care",
            "Geriatric care"
        ]
        cultures = [
            "East Asian",
            "Middle Eastern",
            "Latin American",
            "Eastern European"
        ]
        return {
            "1": {"scenario": random.choice(scenarios), "culture": random.choice(cultures)},
            "2": {"scenario": random.choice(scenarios), "culture": random.choice(cultures)}
        }

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""You have 30 minutes to complete this task. Design an AI system capable of interpreting and generating multimodal communication (verbal, nonverbal, and paralinguistic) in healthcare settings, with a focus on cross-cultural understanding and patient-provider interactions. Apply your system to the scenario of {t['scenario']} with a patient from {t['culture']} culture.

Your response should include the following sections:

1. System Architecture (250-300 words):
   a) Describe the key components of your AI system for interpreting and generating multimodal communication.
   b) Explain how your system integrates verbal, nonverbal, and paralinguistic cues.
   c) Discuss how cultural knowledge is incorporated into your system's architecture.
   d) Propose a novel approach for real-time analysis and generation of multimodal communication.
   e) Provide an ASCII art diagram illustrating the key components and data flow of your system.

2. Cultural Adaptation (200-250 words):
   a) Explain how your system adapts to the specific cultural context of {t['culture']} patients.
   b) Describe potential challenges in interpreting nonverbal cues from this culture and how your system addresses them.
   c) Provide an example of how your system would interpret a culturally specific gesture or expression in the given healthcare scenario.

3. Healthcare Application (200-250 words):
   a) Detail how your AI system would be applied in the {t['scenario']} setting.
   b) Explain how the system assists healthcare providers in understanding and communicating with patients.
   c) Discuss potential benefits and risks of using AI for multimodal communication in this healthcare context.

4. Multimodal Generation (150-200 words):
   a) Describe how your system would generate appropriate verbal and nonverbal responses for a healthcare provider.
   b) Explain how the system ensures cultural sensitivity and medical accuracy in its generated communication.
   c) Provide an example of a multimodal response your system might generate in the given scenario.

5. Rapid Response Subsystem (100-150 words):
   a) Design a subsystem for generating quick, appropriate responses in high-pressure situations.
   b) Explain how this subsystem balances speed with accuracy and cultural sensitivity.
   c) Provide a brief example of a rapid response generated by your system in an emergency situation.

6. Ethical Considerations (150-200 words):
   a) Discuss potential ethical implications of using AI for interpreting and generating multimodal communication in healthcare.
   b) Address privacy concerns related to processing nonverbal patient data.
   c) Propose guidelines for responsible development and use of such systems in healthcare settings.

7. Evaluation Methodology (150-200 words):
   a) Propose a method to evaluate the effectiveness and cultural appropriateness of your system's interpretation and generation capabilities.
   b) Describe metrics you would use to assess accuracy, cultural sensitivity, and impact on patient-provider communication.
   c) Suggest an experiment to test your system's performance against human interpreters or traditional communication methods.

Ensure your response demonstrates a deep understanding of multimodal communication, cultural anthropology, healthcare practices, and AI systems. Use appropriate technical terminology and provide clear explanations for complex concepts. Be innovative in your approach while considering practical feasibility and addressing the unique challenges of the healthcare setting.

Format your response with clear headings for each section. Your total response should be between 1200-1550 words."""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            "The response demonstrates a comprehensive understanding of multimodal communication in healthcare settings",
            f"The system design effectively addresses the specific challenges of {t['scenario']} and {t['culture']} cultural context",
            "The proposed AI system integrates verbal, nonverbal, and paralinguistic cues in a novel and effective manner",
            "The response includes a clear and informative ASCII art diagram of the system architecture",
            "The rapid response subsystem is well-designed and appropriate for high-pressure healthcare situations",
            "The response adequately addresses ethical considerations and proposes realistic evaluation methodologies",
            "The solution is innovative while remaining scientifically and technologically plausible",
            "The response is well-structured and concise, adhering to the word limit while covering all required sections"
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
