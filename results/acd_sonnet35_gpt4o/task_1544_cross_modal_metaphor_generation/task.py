import random

class TaskFamily:
    @staticmethod
    def get_tasks() -> dict[str, dict]:
        concepts = [
            {
                "concept": "Quantum entanglement",
                "source_modality": "visual",
                "target_modality": "auditory"
            },
            {
                "concept": "Neural plasticity",
                "source_modality": "tactile",
                "target_modality": "olfactory"
            },
            {
                "concept": "Dark matter",
                "source_modality": "gustatory",
                "target_modality": "visual"
            },
            {
                "concept": "Climate change",
                "source_modality": "auditory",
                "target_modality": "tactile"
            },
            {
                "concept": "Genetic mutation",
                "source_modality": "olfactory",
                "target_modality": "gustatory"
            },
            {
                "concept": "Black holes",
                "source_modality": "tactile",
                "target_modality": "visual"
            }
        ]
        return {
            "1": random.choice(concepts),
            "2": random.choice(concepts)
        }

    @staticmethod
    def get_instructions(t: dict) -> str:
        return f"""Design an AI system capable of generating and interpreting cross-modal metaphors, then use it to explain the concept of {t['concept']} using a metaphor that maps from the {t['source_modality']} modality to the {t['target_modality']} modality. Your response should include:

1. System Architecture (250-300 words):
   a) Describe the key components of your AI system for cross-modal metaphor generation and interpretation.
   b) Explain how your system represents and processes information from different sensory modalities.
   c) Detail the mechanisms used for mapping concepts between modalities.
   d) Discuss how your system ensures the generated metaphors are both novel and meaningful.

2. Metaphor Generation Process (200-250 words):
   a) Outline the step-by-step process your AI system uses to generate a cross-modal metaphor for {t['concept']}.
   b) Explain how the system selects relevant features from the {t['source_modality']} modality.
   c) Describe how these features are mapped to the {t['target_modality']} modality.
   d) Discuss any challenges specific to this particular modality pairing and how your system addresses them.

3. Example Metaphor (200-250 words):
   a) Present the cross-modal metaphor generated by your AI system to explain {t['concept']}.
   b) Provide a detailed interpretation of the metaphor, explaining how it captures key aspects of the concept.
   c) Discuss how this metaphor might enhance understanding of {t['concept']} for someone unfamiliar with it.
   d) Include a visual representation of the metaphor using ASCII art or a detailed text description.

4. Cognitive Science Insights (200-250 words):
   a) Analyze how your AI's approach to cross-modal metaphor generation compares to human cognitive processes.
   b) Discuss any insights your system might provide into human conceptual mapping and metaphor comprehension.
   c) Propose a hypothesis about cross-modal thinking in humans that could be tested using your AI system.

5. Evaluation and Limitations (150-200 words):
   a) Propose criteria for evaluating the quality and effectiveness of the generated cross-modal metaphors.
   b) Discuss potential limitations of your approach and areas for future improvement.
   c) Consider ethical implications of using AI-generated metaphors to explain complex scientific concepts.

Ensure your response demonstrates a deep understanding of artificial intelligence, cognitive science, and the specific scientific concept being explained. Be creative in your system design and metaphor generation while maintaining scientific plausibility. Adhere to the word limits for each section, and provide a total word count at the end of your response.
"""

    @staticmethod
    def score(t: dict, submission: str) -> float | None:
        from src.eval_helper import eval_with_llm_judge
        instructions = TaskFamily.get_instructions(t)
        criteria = [
            "The response demonstrates a clear understanding of cross-modal metaphor generation and its application in AI.",
            "The proposed AI system design is innovative, detailed, and scientifically plausible.",
            "The metaphor generation process is well-explained and logically sound.",
            "The example metaphor effectively explains the given scientific concept using the specified modalities.",
            "The visual representation of the metaphor is creative and relevant.",
            "The response provides insightful analysis of cognitive science implications.",
            "The evaluation criteria and limitations discussion show critical thinking and awareness of the challenges in this field.",
            "The response maintains coherence and relevance throughout all sections and adheres to the specified word limits."
        ]
        return 1.0 if eval_with_llm_judge(instructions, submission, criteria) else 0.0
